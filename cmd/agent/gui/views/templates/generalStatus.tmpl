{{- with .Stats -}}
  <div class="stat">
    <span class="stat_title">Agent Info</span>
    <span class="stat_data">
      Version: {{.version}}
      <br>Flavor: {{.flavor}}
      <br>PID: {{.pid}}
      {{- if .runnerStats.Workers}}
        <br>Check Workers: {{.runnerStats.Workers.Count}}
      {{end}}
      <br>Agent start: {{ formatUnixTime .agent_start_nano }}
      {{- if .config.log_file}}
        <br>Log File: {{.config.log_file}}
      {{end}}
      <br>Log Level: {{.config.log_level}}
      <br>Config File: {{if .conf_file}}{{.conf_file}}
                       {{else}}There is no config file
                       {{end}}
      <br>Conf.d Path: {{.config.confd_path}}
      <br>Checks.d Path: {{.config.additional_checksd}}
    </span>
  </div>

  <div class="stat">
    <span class="stat_title">System Info</span>
    <span class="stat_data">
      System time: {{ formatUnixTime .time_nano }}
      {{- if .ntpOffset}}
        <br>NTP Offset: {{ humanizeDuration .ntpOffset "s"}}
        {{- if ntpWarning .ntpOffset}}
        <br><span class="warning">NTP Offset is high. Datadog may ignore metrics sent by this Agent.</span>
        {{- end}}
      {{end}}
      <br>Go Version: {{.go_version}}
      <br>Python Version: {{.python_version}}
      <br>Build arch: {{.build_arch}}
    </span>
  </div>

  <div class="stat">
    <span class="stat_title">Host Info</span>
    <span class="stat_data">
      {{- range $type, $value := .hostinfo -}}
        {{- if ne $type "hostname" -}}
          {{- if ne $type "hostid" -}}
            {{if $value}}
              {{formatTitle $type}}: {{if eq $type "bootTime" -}}{{- formatUnixTime $value -}}
                              {{- else -}}{{- if eq $type "uptime" -}}{{- humanizeDuration $value "s" -}}
                              {{- else -}}{{- $value -}}
                              {{- end -}}{{- end -}}<br>
            {{end -}}
          {{end -}}
        {{end -}}
      {{- end}}
    </span>
  </div>

  <div class="stat">
    <span class="stat_title">Hostnames</span>
    <span class="stat_data">
      {{- range $type, $value := .metadata.meta -}}
        {{- if ne $type "timezones" -}}
          {{- if $value}}
            {{formatTitle $type}}: {{$value -}}<br>
          {{end -}}
        {{- end -}}
      {{- end}}
      {{- if gt (len .hostTags) 0 }}
        <span>Host tags: <br>
          <span class="stat_subdata">
            {{- range $tag := .hostTags}}
              {{$tag}}<br>
            {{- end }}
          </span>
        </span>
      {{- end }}
      Hostname Provider: {{.hostnameStats.provider}}<br>
      {{- if gt (len .hostnameStats.errors) 0 }}
        <span>Unused Hostname Providers: <br>
          <span class="stat_subdata">
            {{- range $name, $value := .hostnameStats.errors -}}
              {{- if ne $name "all" }}
                {{formatTitle $name}}: {{$value}}<br>
              {{- end}}
            {{- end }}
          </span>
        </span>
      {{- if .hostnameStats.errors.all }}
        <span class="error">Error</span>: {{.hostnameStats.errors.all}}<br>
      {{- end }}
      {{- end }}

    </span>
  </div>

  <div class="stat">
    <span class="stat_title">Metadata</span>
    <span class="stat_data">
    {{- range $key, $value := .agent_metadata }}
      {{ $key }}: {{ $value }}<br>
    {{- end }}
    </span>
  </div>

  {{- if eq .config.fips_enabled "true" }}

    <div class="stat">
      <span class="stat_title">FIPS proxy</span>
      <span class="stat_data">
        FIPS proxy is enabled. All communication will be routed to a local FIPS proxy:<br>
          - Local address: {{ .config.fips_local_address }}<br>
          - Starting port range: {{ .config.fips_port_range_start }}<br>
      </span>
  {{- end }}

  {{- if .TransportWarnings }}
    <div class="stat">
      <span class="stat_title">Transport Proxy Warnings</span>
      {{- if .NoProxyIgnoredWarningMap }}
      <span class="stat_data">
      The following hosts used a proxy - but will ignore the proxy in future Agent versions with the no_proxy setting.
      Enable the new behavior now with no_proxy_nonexact_match: true
        <span class="stat_data">
        {{- range $.NoProxyIgnoredWarningMap }}
          {{ . }}<br>
        {{- end }}
        </span>
      </span>
      {{- end }}
      {{- if .NoProxyUsedInFuture }}
      <span class="stat_data">
      The following hosts did not use a proxy - but will use the proxy in future Agent versions with the no_proxy setting.
      Enable the new behavior now with no_proxy_nonexact_match: true
        <span class="stat_data">
        {{- range $.NoProxyUsedInFuture }}
          {{ . }}<br>
        {{- end }}
        </span>
      </span>
      {{- end }}
      {{- if .NoProxyChanged }}
      <span class="stat_data">
      The following hosts' proxy behavior will change in a future Agent version. Please check the Agent logs for more details.
      Enable the new behavior now with no_proxy_nonexact_match: true
        <span class="stat_data">
        {{- range .NoProxyChanged }}
          {{ . }}<br>
        {{- end }}
        </span>
      </span>
      {{- end }}
    </div>
  {{- end }}

  <div class="stat">
    <span class="stat_title">JMX Status</span>
    <span class="stat_data">
      {{ if .JMXStartupError.LastError }}
      <span class="stat_subtitle">JMX startup errors</span>
        <span class="stat_subdata">
          Error: {{ .JMXStartupError.LastError }} <br>
          Date: {{ formatUnixTime .JMXStartupError.Timestamp }}
        </span>
      {{ end -}}
      {{- with .JMXStatus -}}
        {{- if and (not .timestamp) (not .checks)}}
          No JMX status available
        {{- else }}
          <span class="stat_subtitle">Information</span>
          <span class="stat_subdata">
            {{- range $k,$v := .info }}
              {{ $k }} : {{ $v }}<br>
            {{- end }}
            {{- if .errors }}
              Socket errors: {{ .errors }}
            {{- end }}
          </span>
          <span class="stat_subtitle">Initialized Checks</span>
          <span class="stat_subdata">
            {{- if (not .checks.initialized_checks)}}
              No initialized checks
            {{ else }}
              {{- range $check,$instances := .checks.initialized_checks }}
                {{ $check -}}<br>
                {{- range $instance := $instances }}
                    instance_name: {{ .instance_name }}<br>
                    metric_count: {{ .metric_count }}<br>
                    service_check_count: {{ .service_check_count }}<br>
                    message: {{ .message }}<br>
                    status: {{ .status }}<br>
                    <br>
                {{- end -}}
              {{- end }}
            {{- end -}}
          </span>
          <span class="stat_subtitle">Failed Checks</span>
          <span class="stat_subdata">
            {{- if (not .checks.failed_checks)}}
              No failed checks
            {{ else }}
              {{- range $check,$instances := .checks.failed_checks }}
                {{ $check }}<br>
                {{- range $instance := $instances }}
                  {{- range $k,$v := $instance }}
                    {{ $k }} : {{ $v }}<br>
                  {{- end -}}
                {{- end -}}
              {{- end -}}
            {{- end -}}
          </span>
        {{- end -}}
      {{- end -}}
    </span>

  </div>
  <div class="stat">
    <span class="stat_title">Forwarder</span>
    <span class="stat_data">
      {{- with .forwarderStats -}}
        {{- range $key, $value := .Transactions }}
            {{- if and (ne $key "InputBytesByEndpoint") (ne $key "InputCountByEndpoint") (ne $key "DroppedByEndpoint") (ne $key "RequeuedByEndpoint") (ne $key "RetriedByEndpoint") (ne $key "Success") (ne $key "SuccessByEndpoint") (ne $key "SuccessBytesByEndpoint") (ne $key "Errors") (ne $key "ErrorsByType") (ne $key "HTTPErrors") (ne $key "HTTPErrorsByCode") (ne $key "ConnectionEvents")}}
          {{formatTitle $key}}: {{humanize $value}}<br>
            {{- end}}
        {{- end}}
        {{- if .Transactions.Success }}
          <span class="stat_subtitle">Transaction Successes</span>
            <span class="stat_subdata">
              Total number: {{.Transactions.Success}}<br>
              Successes By Endpoint:<br>
              <span class="stat_subdata">
                {{- range $type, $count := .Transactions.SuccessByEndpoint }}
                  {{- if $count}}
                    {{$type}}: {{humanize $count}}<br>
                  {{- end}}
                {{- end}}
              </span>
            </span>
          </span>
        {{- end}}
        {{- if .Transactions.Errors }}
          <span class="stat_subtitle">Transaction Errors</span>
            <span class="stat_subdata">
              Total number: {{.Transactions.Errors}}<br>
              Errors By Type:<br>
              <span class="stat_subdata">
                {{- range $type, $count := .Transactions.ErrorsByType }}
                  {{- if $count}}
                    {{$type}}: {{humanize $count}}<br>
                  {{- end}}
                {{- end}}
              </span>
            </span>
          </span>
        {{- end}}
        {{- if .Transactions.HTTPErrors }}
          <span class="stat_subtitle">HTTP Errors</span>
            <span class="stat_subdata">
              Total number: {{.Transactions.HTTPErrors}}<br>
              HTTP Errors By Code:<br>
              <span class="stat_subdata">
                {{- range $code, $count := .Transactions.HTTPErrorsByCode }}
                  {{- if $count}}
                    {{$code}}: {{humanize $count}}<br>
                  {{- end}}
                {{- end}}
              </span>
            </span>
          </span>
        {{- end}}
      {{- end -}}
      {{- with .forwarderStats -}}
        <span class="stat_subtitle">On-disk storage</span>
        <span class="stat_subdata">
        {{- if .forwarder_storage_max_size_in_bytes }}
          {{- if .FileStorage.CurrentSizeInBytes }}
          Disk usage in bytes: {{ .FileStorage.CurrentSizeInBytes }}<br>
          Number of files: {{ .FileStorage.FilesCount }}<br>
          Number of files dropped: {{ .FileStorage.FilesRemovedCount }}<br>
          Deserialization errors count: {{ .FileStorage.DeserializeErrorsCount }}<br>
          Outdated files removed at startup: {{ .RemovalPolicy.OutdatedFilesCount }}<br>
          {{- else }}
          Enabled, not in-use.<br>
          {{- end}}
        {{- else }}
          On-disk storage is disabled. Configure `forwarder_storage_max_size_in_bytes` to enable it.<br>
        {{- end}}
        </span>
        {{- if .APIKeyStatus}}
          <span class="stat_subtitle">API Keys Status</span>
          <span class="stat_subdata">
            {{- range $key, $value := .APIKeyStatus}}
              {{$key}}: {{$value}}<br>
            {{- end -}}
          </span>
        {{- end}}
        {{- if .APIKeyFailure}}
          <span class="stat_subtitle">API Keys Errors</span>
          <span class="stat_subdata">
            {{ range $key, $value := .APIKeyFailure}}
              <span class="warning"> {{$key}}: {{$value}} <span> <br>
            {{- end -}}
          </span>
        {{- end}}
      {{- end -}}
    </span>
  </div>

  <div class="stat">
    <span class="stat_title">Endpoints</span>
    <span class="stat_data">
    {{- with .endpointsInfos}}
      {{- range $key, $value := .}}
        {{$key}}
          - API Key{{ if gt (len $value) 1}}s{{end}} ending with: <br>
          {{- range $idx, $apikey := $value }}
          &nbsp;&nbsp;- {{$apikey}} <br>
          {{- end}}
        <br>
      {{- end}}
    {{- else }}
      No endpoints information. The agent may be misconfigured.
    {{- end}}
    </span>
  </div>

  <div class="stat">
    <span class="stat_title">Logs Agent</span>
    <span class="stat_data">
    {{- with .logsStats -}}
      {{- if eq .is_running false }}

        Logs Agent is not running </br>
      {{- end }}
      {{- if .endpoints }}

        {{- range $endpoint := .endpoints }}
          {{ $endpoint }}<br>
        {{- end }}
      {{- end }}
      {{- if and (eq .use_http false) (.is_running) }}

        You are currently sending Logs to Datadog through TCP (either because logs_config.force_use_tcp or logs_config.socks5_proxy_address is set or the HTTP connectivity test has failed). To benefit from increased reliability and better network performances, we strongly encourage switching over to compressed HTTPS which is now the default protocol.</br>
      {{- end }}
      {{- if .metrics }}

        {{- range $metric_name, $metric_value := .metrics }}
          {{$metric_name}}: {{$metric_value}}<br>
        {{- end }}
      {{- end }}
      {{- if .errors }}

        <span class="error stat_subtitle">Errors</span>
        <span class="stat_subdata">
        {{- range $error := .errors }}
          {{ $error }}</br>
        {{- end }}
        </span>
      {{- end}}
      {{- if .warnings }}

        <span class="warning stat_subtitle">Warnings</span>
        <span class="stat_subdata">
        {{- range $warning := .warnings }}
          {{ $warning }}</br>
        {{- end }}
        </span>
      {{- end}}
      {{- range .integrations }}

        <span class="stat_subtitle">{{ .name }}</span>
        <span class="stat_subdata">
          {{- range .sources }}
            <span class="stat_subdata">
            Type: {{ .type }}</br>
            {{- range $key, $value := .configuration }}
            {{$key}}: {{$value}}</br>
            {{- end }}
            {{- if .status }}
            Status: {{ .status }}</br>
            {{- range $message := .messages }}
              {{ $message }}</br>
            {{- end }}
            {{- end }}
            {{- if .inputs }}
            Inputs:
            <ul>
              {{- range $input := .inputs }}
                <li>{{$input}}
              {{- end }}
            </ul>
            {{- end }}
            {{- if .info }}
            {{- range $key, $value := .info }} {{ $len := len $value }} {{ if eq $len 1 }}
            {{$key}}: {{index $value 0}}</br> {{ else }}
            {{$key}}:</br>
              <span class="stat_subdata">
                {{- range $inf := $value }}
                  {{ $inf }}</br>
                {{- end }}
              </span>
            {{- end }}
            {{- end }}
            {{- end }}
            </span>
          {{- end }}
        </span>
      {{- end }}
    {{- end -}}
    </span>
  </div>

  <div class="stat">
    <span class="stat_title">Aggregator</span>
    <span class="stat_data">
      {{- with .aggregatorStats -}}
        {{- if .ChecksMetricSample}}
          Checks Metric Sample: {{humanize .ChecksMetricSample}}<br>
        {{- end -}}
        {{- if .DogstatsdMetricSample}}
          Dogstatsd Metric Sample: {{.DogstatsdMetricSample}}<br>
        {{- end}}
        {{- if .Event}}
          Event: {{humanize .Event}}<br>
        {{- end -}}
        {{- if .EventsFlushed}}
          Events Flushed: {{humanize .EventsFlushed}}<br>
        {{- end -}}
        {{- if .EventsFlushErrors}}
          Events Flush Errors: {{.EventsFlushErrors}}<br>
        {{- end -}}
        {{- if .NumberOfFlush}}
          Number Of Flushes: {{humanize .NumberOfFlush}}<br>
        {{- end -}}
        {{- if .SeriesFlushed}}
          Series Flushed: {{humanize .SeriesFlushed}}<br>
        {{- end -}}
        {{- if .SeriesFlushErrors}}
          Series Flush Errors: {{.SeriesFlushErrors}}<br>
        {{- end -}}
        {{- if .ServiceCheck}}
          Service Check: {{humanize .ServiceCheck}}<br>
        {{- end -}}
        {{- if .ServiceCheckFlushed}}
          Service Checks Flushed: {{humanize .ServiceCheckFlushed}}<br>
        {{- end -}}
        {{- if .ServiceCheckFlushErrors}}
          Service Checks Flush Errors: {{.ServiceCheckFlushErrors}}<br>
        {{- end -}}
        {{- if .SketchesFlushed}}
          Sketches Flushed: {{humanize .SketchesFlushed}}<br>
        {{- end -}}
        {{- if .SketchesFlushErrors}}
          Sketches Flush Errors: {{.SketchesFlushErrors}}<br>
        {{- end -}}
        {{- if .ChecksHistogramBucketMetricSample}}
          Checks Histogram Bucket Metric Sample: {{.ChecksHistogramBucketMetricSample}}<br>
        {{- end -}}
        {{- if .EventPlatformEvents }}
        {{- range $k, $v := .EventPlatformEvents }}
          {{ $k }}: {{humanize $v}}
        {{- end }}
        {{- end }}
        {{- if .HostnameUpdate}}
          Hostname Update: {{humanize .HostnameUpdate}}<br>
        {{- end }}
      {{- end -}}
    </span>
  </div>

  <div class="stat">
    <span class="stat_title">DogStatsD</span>
    <span class="stat_data">
      {{- with .dogstatsdStats -}}
        {{- range $key, $value := .}}
          {{formatTitle $key}}: {{humanize $value}}<br>
        {{- end }}
      {{- end -}}
    </span>
  </div>

  <div class="stat">
    <span class="stat_title">APM</span>
    <span class="stat_data">
      {{- with .apmStats -}}
        {{- if .error }}
          Not running or unreachable on localhost:{{.port}}<br>
          Error: {{.error}}<br>
        {{- else}}
          Status: Running<br>
          Pid: {{.pid}}<br>
          Uptime: {{.uptime}} seconds<br>
          Mem alloc: {{humanize .memstats.Alloc}} bytes<br>
          Hostname: {{.config.Hostname}}<br>
          Receiver: {{.config.ReceiverHost}}:{{.config.ReceiverPort}}<br>
          Endpoints:
          <span class="stat_subdata">
            {{- range $i, $e := .config.Endpoints}}
              {{ $e.Host }}<br />
            {{- end }}
          </span>
          <span class="stat_subtitle">Receiver (previous minute)</span>
          <span class="stat_subdata">
            {{- if eq (len .receiver) 0}}
              No traces received in the previous minute.<br>
            {{ else }}
              {{ range $i, $ts := .receiver }}
                From {{if $ts.Lang}}{{ $ts.Lang }} {{ $ts.LangVersion }} ({{ $ts.Interpreter }}), client {{ $ts.TracerVersion }}{{else}}unknown clients{{end}}
                <span class="stat_subdata">
                  Traces received: {{ $ts.TracesReceived }} ({{ humanize $ts.TracesBytes }} bytes)<br>
                  Spans received: {{ $ts.SpansReceived }}
                  {{ with $ts.WarnString }}
                    <br>WARNING: {{ . }}</br>
                  {{ end }}
                </span>
              {{ end }}
            {{ end }}

            {{range $key, $value := .ratebyservice_filtered -}}
              {{- if eq $key "service:,env:" -}}
                Default priority sampling rate: {{percent $value}}%
              {{- else}}
                Priority sampling rate for '{{ $key }}': {{percent $value}}%
              {{- end}}
            {{- end }}
          </span>
          <span class="stat_subtitle">Writer (previous minute)</span>
          <span class="stat_subdata">
            Traces: {{.trace_writer.Payloads}} payloads, {{.trace_writer.Traces}} traces, {{.trace_writer.Events}} events, {{humanize .trace_writer.Bytes}} bytes<br>
            {{- if gt .trace_writer.Errors 0.0}}WARNING: Traces API errors (1 min): {{.trace_writer.Errors}}{{end}}
            Stats: {{.stats_writer.Payloads}} payloads, {{.stats_writer.StatsBuckets}} stats buckets, {{humanize .stats_writer.Bytes}} bytes<br>
            {{- if gt .stats_writer.Errors 0.0}}WARNING: Stats API errors (1 min): {{.stats_writer.Errors}}{{end}}
          </span>
        {{- end }}
      {{ end }}
    </span>
  </div>

  {{- with .snmpTrapsStats -}}
    <div class="stat">
      <span class="stat_title">SNMP Traps</span>
      <span class="stat_data">
          {{- if .error }}
            Error: {{.error}}<br>
          {{- end }}
          {{- range $key, $value := .metrics}}
            {{formatTitle $key}}: {{humanize $value}}<br>
          {{- end }}
      </span>
    </div>
  {{- end -}}

  {{- with .netflowStats -}}
    <div class="stat">
      <span class="stat_title">NetFlow</span>
      <span class="stat_data">
          Total Listeners: {{.TotalListeners}}
          <br>Open Listeners: {{.OpenListeners}}
          <br>Closed Listeners: {{.ClosedListeners}}
          {{ if .OpenListeners }}
          <span class="stat_subtitle">Open Listener Details</span>
          {{- range $index, $NetflowListenerStatus := .WorkingListenerDetails }}
          BindHost: {{$NetflowListenerStatus.Config.BindHost}}
          <br>FlowType: {{$NetflowListenerStatus.Config.FlowType}}
          <br>Port: {{$NetflowListenerStatus.Config.Port}}
          <br>Workers: {{$NetflowListenerStatus.Config.Workers}}
          <br>Namespace: {{$NetflowListenerStatus.Config.Namespace}}
          <br>Flows Received: {{$NetflowListenerStatus.FlowCount}}
          <br>
          <br>
          {{- end }}
          {{ end }}
          <br>
          {{ if .ClosedListeners }}
          <br>
          <span class="stat_subtitle">Closed Listener Details</span>
          {{- range $index, $NetflowListenerStatus := .ClosedListenerDetails }}
          BindHost: {{$NetflowListenerStatus.Config.BindHost}}
          <br>FlowType: {{$NetflowListenerStatus.Config.FlowType}}
          <br>Port: {{$NetflowListenerStatus.Config.Port}}
          <br>Workers: {{$NetflowListenerStatus.Config.Workers}}
          <br>Namespace: {{$NetflowListenerStatus.Config.Namespace}}
          <br>Error: {{$NetflowListenerStatus.Error}}
          <br>
          <br>
          {{- end }}
          {{ end }}
      </span>
    </div>
  {{- end -}}


  <div class="stat">
    <span class="stat_title">Remote Configuration</span>
    <span class="stat_data">
      {{ with .remoteConfiguration }}
        API Key: {{ if .apiKeyScoped }}Authorized{{ else }}Not authorized{{ end }}
        Feature: {{ if .orgEnabled }}Enabled{{ else }}Disabled{{ end }}
        Last error: {{ if .lastError }}{{ .lastError }}{{ else }}None{{ end }}
      {{ else }}
        Remote Configuration is disabled
      {{ end }}
    </span>
  </div>

  <div class="stat">
    <span class="stat_title">OTLP</span>
    <span class="stat_data">
      {{ with .otlp }}
        Status: {{ if .otlpStatus }}Enabled{{else}}Not enabled{{end}}
        <br>Collector status: {{ .otlpCollectorStatus }}
        {{ if .otlpCollectorStatusErr }}
          <br><span class="error">Error</span>: <b>{{ .otlpCollectorStatusErr }}</b>
        {{ end }}
      {{ end }}
    </span>
  </div>
{{- end -}}
