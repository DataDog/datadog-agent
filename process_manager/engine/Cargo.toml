[package]
name = "pm_engine"
version = "0.1.0"
edition = "2021"

[lib]
name = "pm_engine"
crate-type = ["rlib", "cdylib"]

[[bin]]
name = "dd-procmgrd"
path = "src/bin/daemon.rs"

[dependencies]
uuid = { version = "1", features = ["v4", "serde"] }
serde = { version = "1", features = ["derive"] }
serde_json = "1.0"
serde_yaml = "0.9"
once_cell = "1.20"
tracing = "0.1"
libc = "0.2"
tokio = { version = "1", features = ["full"] }
ureq = { version = "2", features = [] }
async-trait = "0.1"
thiserror = "1.0"
tokio-util = "0.7"
# Driving adapters dependencies
tonic = { version = "0.9", features = ["transport"] }
tonic-reflection = "0.9"
tonic-health = "0.9"
prost = "0.11"
axum = "0.6"
tokio-stream = { version = "0.1", features = ["net"] }
http = "0.2"
hyper = "0.14"
tracing-subscriber = { version = "0.3", features = ["env-filter", "fmt"] }

# Linux capabilities support (optional, Linux-only)
[target.'cfg(target_os = "linux")'.dependencies]
caps = "0.5"

# Windows-specific dependencies
[target.'cfg(target_os = "windows")'.dependencies]
windows = { version = "0.58", features = [
    "Win32_Foundation",
    "Win32_System_Threading",
    "Win32_System_JobObjects",
    "Win32_Security",
    "Win32_System_Pipes",
    "Win32_Storage_FileSystem",
    "Win32_System_IO",
    "Win32_System_Console",
    "Win32_System_ProcessStatus",
] }
windows-service = "0.7"
tracing-appender = "0.2"

[dev-dependencies]
serial_test = "3"
mockall = "0.12"
tokio-test = "0.4"
tracing-subscriber = { version = "0.3", features = ["env-filter", "fmt"] }
# Adapter testing dependencies
tower = { version = "0.4", features = ["util"] }
hyper = "0.14"
tempfile = "3"

[build-dependencies]
tonic-build = "0.9"
