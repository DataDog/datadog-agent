# Datadog System Probe - Process Manager Configuration (Windows)
#
# This configuration is used by dd-procmgrd to supervise the System Probe.
# Place this file at: C:\ProgramData\Datadog\process-manager\processes.d\datadog-agent-sysprobe.yaml
#
# System Probe provides kernel-level monitoring for network, security, and process data.

description: Datadog System Probe
command: C:\Program Files\Datadog\Datadog Agent\bin\agent\system-probe.exe
args:
  - run
  - -c
  - C:\ProgramData\Datadog\system-probe.yaml
process_type: simple
auto_start: false  # Started via 'wants' from main agent

# Restart policy
restart: on-failure

# Start limits
start_limit_interval_sec: 10
start_limit_burst: 5

# Environment file (prefix with '-' to ignore if file doesn't exist)
environment_file: -C:\ProgramData\Datadog\environment

# Environment variables
env:
  DD_FLEET_POLICIES_DIR: C:\ProgramData\Datadog\managed\datadog-agent\stable

# Conditional starting
# Process only starts if at least one of these config files exists
condition_path_exists:
  - "|C:\ProgramData\Datadog\system-probe.yaml"
  - "|C:\ProgramData\Datadog\managed\datadog-agent\stable\system-probe.yaml"

# Ordering - this should start before the main agent
before:
  - datadog-agent

# Binding - this process is bound to the main agent (stops when main agent stops)
binds_to:
  - datadog-agent

# Mutual exclusion
conflicts:
  - datadog-agent-sysprobe-exp

# Output handling
stdout: inherit
stderr: inherit
