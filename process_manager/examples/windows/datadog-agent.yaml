# Datadog Agent - Process Manager Configuration (Windows)
#
# This configuration is used by dd-procmgrd to supervise the main Datadog Agent process.
# Place this file at: C:\ProgramData\Datadog\process-manager\processes.d\datadog-agent.yaml
# The process name is derived from the filename (datadog-agent)

description: Datadog Agent
command: C:\Program Files\Datadog\Datadog Agent\bin\agent.exe
args:
  - run
  - -c
  - C:\ProgramData\Datadog\datadog.yaml
process_type: simple
auto_start: true

# Restart policy
restart: on-failure

# Start limits
start_limit_interval_sec: 10
start_limit_burst: 5

# PID file
pidfile: C:\ProgramData\Datadog\run\agent.pid

# Environment file (prefix with '-' to ignore if file doesn't exist)
environment_file: -C:\ProgramData\Datadog\environment

# Environment variables
env:
  DD_FLEET_POLICIES_DIR: C:\ProgramData\Datadog\managed\datadog-agent\stable

# Mutual exclusion - only one variant can run at a time
conflicts:
  - datadog-agent-exp

# Soft dependencies
# Auto-starts these processes if they are defined, but continues if they fail
# Note: datadog-agent-trace uses socket activation (starts on first connection)
wants:
  - datadog-agent-process
  - datadog-agent-sysprobe
  - datadog-agent-security

# Output handling
stdout: inherit
stderr: inherit
