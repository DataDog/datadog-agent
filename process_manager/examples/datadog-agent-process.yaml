# Datadog Process Agent - Process Manager Configuration
# Equivalent to the systemd datadog-agent-process.service unit
#
# This configuration is used by dd-procmgrd to supervise the Datadog Process Agent.
# Place this file at: /etc/pm/processes.d/datadog-agent-process.yaml
# The process name is derived from the filename (datadog-agent-process)

description: Datadog Process Agent
command: /opt/datadog-agent/embedded/bin/process-agent
args:
  - --cfgpath=/etc/datadog-agent/datadog.yaml
  - --sysprobe-config=/etc/datadog-agent/system-probe.yaml
# Note: --pid arg removed - process manager tracks PIDs internally
process_type: simple
auto_start: false  # Started via 'wants' from main agent

# User to run as (systemd User=dd-agent)
user: dd-agent

# Restart policy (systemd Restart=on-failure)
restart: on-failure

# Start limits (systemd StartLimitInterval=10, StartLimitBurst=5)
start_limit_interval_sec: 10
start_limit_burst: 5

# Environment file (systemd EnvironmentFile=-)
environment_file: -/etc/datadog-agent/environment

# Environment variables (systemd Environment=)
env:
  DD_FLEET_POLICIES_DIR: /etc/datadog-agent/managed/datadog-agent/stable

# Ambient capabilities (systemd AmbientCapabilities=)
# Allows binding to privileged ports (< 1024) when running as non-root
ambient_capabilities:
  - CAP_NET_BIND_SERVICE

# Ordering (systemd After=)
after:
  - datadog-agent
  - datadog-agent-exp

# Binding (systemd BindsTo=)
# This process is bound to the main agent - stops when main agent stops
binds_to:
  - datadog-agent

# Mutual exclusion (systemd Conflicts=)
conflicts:
  - datadog-agent-exp
  - datadog-agent-process-exp

# Output handling
stdout: inherit
stderr: inherit

