.bazel:test:
  rules:
    - !reference [ .except_mergequeue ]
    - when: on_success
  stage: source_test

bazel:test:linux-amd64:
  extends: [ .bazel:test, .bazel:runner:linux-amd64 ]
  script:
    #TODO(regis): fix and enable failing targets
    - >-
      bazel test //... --
      -//pkg/discovery/module/rust:dd_discovery
      -//pkg/discovery/module/rust:dd_discovery_test
      -//pkg/discovery/module/rust:libdd_discovery

bazel:test:linux-arm64:
  extends: [ .bazel:test, .bazel:runner:linux-arm64 ]
  script:
    #TODO(regis): fix and enable failing targets
    - >-
      bazel test //... --
      -//pkg/discovery/module/rust:dd_discovery
      -//pkg/discovery/module/rust:dd_discovery_test
      -//pkg/discovery/module/rust:libdd_discovery

bazel:test:macos-amd64:
  extends: [ .bazel:test, .bazel:runner:macos-amd64 ]
  script:
    - bazel test //bazel/tests/...

bazel:test:macos-arm64:
  extends: [ .bazel:test, .bazel:runner:macos-arm64 ]
  script:
    - bazel test //bazel/tests/...

bazel:test:windows-amd64:
  extends: [ .bazel:test, .bazel:runner:windows-amd64 ]
  variables:
    POWERSHELL_SCRIPT: |-
      bazel test //bazel/tests/...
