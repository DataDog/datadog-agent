.integration_tests_deb:
  stage: integration_test
  needs: ["go_deps", "go_tools_deps"]
  rules:
    - !reference [.except_mergequeue]
    - when: on_success
  tags: ["docker-in-docker:amd64"]
  before_script:
    - !reference [.retrieve_linux_go_deps]
    - !reference [.retrieve_linux_go_tools_deps]

trace_agent_integration_tests:
  extends: .integration_tests_deb
  image: registry.ddbuild.io/ci/datadog-agent-buildimages/docker_x64$DATADOG_AGENT_BUILDIMAGES_SUFFIX:$DATADOG_AGENT_BUILDIMAGES
  timeout: 50m
  retry: 2
  script:
    - inv -e trace-agent.integration-tests --race
