---
.deploy_packages:
  image: 486234852809.dkr.ecr.us-east-1.amazonaws.com/ci/datadog-agent-builders/gitlab_agent_deploy:$DATADOG_AGENT_BUILDERS
  stage: deploy_packages
  tags: ["arch:amd64"]
  rules:
    !reference [.on_deploy]
  variables:
    DD_PKG_ARCH: x86_64
    MAJOR_VERSION: 6
  before_script:
    - ls $OMNIBUS_PACKAGE_DIR
    # Make job fail if there no files to upload are found
    - ls ${OMNIBUS_PACKAGE_DIR}/${ARTIFACT_NAME_PATTERN}
  script:
    - !reference [.setup_dd_pkg]
    - dd-pkg upload "${OMNIBUS_PACKAGE_DIR}" "${DD_PKG_EXTRA_ARGS}"

.deploy_packages_deb:
  extends: .deploy_packages
  resource_group: deb_bucket

.deploy_packages_rpm:
  extends: .deploy_packages
  resource_group: rpm_bucket
  variables:
    ARTIFACTS_PREFIX: ""

.deploy_packages_suse_rpm:
  extends: .deploy_packages_rpm
  variables:
    ARTIFACTS_PREFIX: suse_
    OMNIBUS_PACKAGE_DIR: $OMNIBUS_PACKAGE_DIR_SUSE

