---
# deploy cws-instrumentation stage
# Contains jobs which create child pipelines to deploy CWS Instrumentation to staging repositories and to Dockerhub / GCR.

deploy_containers-cws-instrumentation:
  stage: deploy_cws_instrumentation
  rules:
    !reference [.on_deploy]
  variables:
    PARENT_PIPELINE_ID: $CI_PIPELINE_ID
    BUCKET_BRANCH: $BUCKET_BRANCH
  trigger:
    include: .gitlab/deploy_cws_instrumentation/deploy_cws_instrumentation_trigger.yml

deploy_containers-cws-instrumentation-on-failure:
  stage: deploy_cws_instrumentation
  rules:
    !reference [.on_deploy_failure]
  variables:
    PARENT_PIPELINE_ID: $CI_PIPELINE_ID
    BUCKET_BRANCH: $BUCKET_BRANCH
    FORCE_MANUAL: "true"
  trigger:
    include: .gitlab/deploy_cws_instrumentation/deploy_cws_instrumentation_trigger.yml
