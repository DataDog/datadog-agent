---
.if_version_7: &if_version_7
  if: $RELEASE_VERSION_7 != ""

.if_deploy_7: &if_deploy_7
  if: $DEPLOY_AGENT == "true" && $RELEASE_VERSION_7 != ""

docker_trigger_internal_amd64:
  stage: image_deploy
  rules:
    - <<: *if_version_7
      when: on_success
    - <<: *if_deploy_7
      when: on_success
  needs:
    - job: docker_build_agent7_jmx
      artifacts: false
  trigger:
    project: DataDog/images
    branch: master
    strategy: depend
  variables:
    IMAGE_VERSION: tmpl-v1
    IMAGE_NAME: datadog-agent
    RELEASE_TAG: ${CI_COMMIT_REF_SLUG}-jmx
    BUILD_TAG: ${CI_COMMIT_REF_SLUG}-jmx
    TMPL_AGENT_SRC_IMAGE: v${CI_PIPELINE_ID}-${CI_COMMIT_SHORT_SHA}-7-jmx-amd64
    RELEASE_STAGING: "true"
    RELEASE_PROD: "true"
