.bazel:tests:
  extends: .bazel:defs
  rules:
    - !reference [ .except_mergequeue ]
    - when: on_success
  stage: source_test

bazel:tests:linux-amd64:
  extends: [ .bazel:tests, .bazel:persistent-runner:linux-amd64 ]
  script:
    - bazel test //bazel/tests/... || cat /data/bzl/bazel/649c250ddb88e3a1390a686c647ce4c2/execroot/_main/bazel-out/k8-fastbuild/testlogs/bazel/tests/does_python_work/test.log

bazel:tests:linux-arm64:
  extends: [ .bazel:tests, .linux_arm64 ]
  script:
    - bazel test //bazel/tests/...

bazel:tests:macos-amd64:
  extends: .bazel:tests
  tags: [ "macos:ventura-amd64", "specific:true" ]
  script:
    - bazel test //bazel/tests/...

bazel:tests:macos-arm64:
  extends: .bazel:tests
  tags: [ "macos:ventura-arm64", "specific:true" ]
  script:
    - bazel test //bazel/tests/...

bazel:tests:windows-amd64:
  extends: [ .bazel:tests, .bazel:ext:windows ]
  variables:
    ARCH: x64
    SCRIPT: |-
      bazel test //bazel/tests/...
