bazel:mod-deps:
  extends: .bazel:runner:linux-amd64
  stage: lint
  script:
    - |
      if ! bazel mod deps --lockfile_mode=error; then
        echo >&2 "ğŸŸ¡ï¸ triggering in-memory cache refresh to try again"
        bazel mod deps --lockfile_mode=refresh
        git diff --exit-code || git restore MODULE.bazel.lock
        bazel mod deps --lockfile_mode=error
      fi
  after_script:
    - |-
      if [ $CI_JOB_STATUS = failed ]; then
        echo >&2 "ğŸ’¡ bazel mod deps"
      fi

bazel:run-buildifier-test:
  extends: .bazel:runner:linux-amd64
  stage: lint
  script:
    - bazel run //bazel/buildifier:test
  after_script:
    - |-
      if [ $CI_JOB_STATUS = failed ]; then
        echo >&2 "ğŸ’¡ bazel run //bazel/buildifier"
      fi
