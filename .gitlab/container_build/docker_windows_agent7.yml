---
# All Windows builds: nanoserver and servercore, all variants, with/without JMX
docker_build_agent7_windows:
  extends: .docker_build_agent7_windows_common
  parallel:
    matrix:
      # Nanoserver builds
      - VARIANT: "1809"
        SERVER_BASE_IMAGE: "mcr.microsoft.com/powershell:lts-nanoserver-1809"
        WINDOWS_RUNNER: "windows-v2:2019"
        OS_TYPE: "nano"
        OS_DISPLAY_NAME: "windows nanoserver"
        TAG_SUFFIX: ["-7", "-7-jmx"]
        WITH_JMX: ["false", "true"]
      - VARIANT: "ltsc2022"
        SERVER_BASE_IMAGE: "mcr.microsoft.com/dotnet/sdk:9.0-nanoserver-ltsc2022"
        WINDOWS_RUNNER: "windows-v2:2022"
        OS_TYPE: "nano"
        OS_DISPLAY_NAME: "windows nanoserver"
        TAG_SUFFIX: ["-7", "-7-jmx"]
        WITH_JMX: ["false", "true"]
      - VARIANT: "ltsc2025"
        SERVER_BASE_IMAGE: "mcr.microsoft.com/dotnet/sdk:9.0-nanoserver-ltsc2025"
        WINDOWS_RUNNER: "windows-v2:2025"
        OS_TYPE: "nano"
        OS_DISPLAY_NAME: "windows nanoserver"
        TAG_SUFFIX: ["-7", "-7-jmx"]
        WITH_JMX: ["false", "true"]
        ALLOW_FAILURE: "true"
      # Servercore builds
      - VARIANT: "1809"
        SERVER_BASE_IMAGE: "mcr.microsoft.com/powershell:windowsservercore-1809"
        WINDOWS_RUNNER: "windows-v2:2019"
        OS_TYPE: "core"
        OS_DISPLAY_NAME: "windows server core"
        SERVERCORE: "-servercore"
        TAG_SUFFIX: ["-7", "-7-jmx"]
        WITH_JMX: ["false", "true"]
      - VARIANT: "ltsc2022"
        SERVER_BASE_IMAGE: "mcr.microsoft.com/dotnet/sdk:9.0-windowsservercore-ltsc2022"
        WINDOWS_RUNNER: "windows-v2:2022"
        OS_TYPE: "core"
        OS_DISPLAY_NAME: "windows server core"
        SERVERCORE: "-servercore"
        TAG_SUFFIX: ["-7", "-7-jmx"]
        WITH_JMX: ["false", "true"]
      - VARIANT: "ltsc2025"
        SERVER_BASE_IMAGE: "mcr.microsoft.com/dotnet/sdk:9.0-windowsservercore-ltsc2025"
        WINDOWS_RUNNER: "windows-v2:2025"
        OS_TYPE: "core"
        OS_DISPLAY_NAME: "windows server core"
        SERVERCORE: "-servercore"
        TAG_SUFFIX: ["-7", "-7-jmx"]
        WITH_JMX: ["false", "true"]
        ALLOW_FAILURE: "true"
  tags: [$WINDOWS_RUNNER]
  allow_failure: $ALLOW_FAILURE
  variables:
    OVERRIDE_GIT_STRATEGY: "clone"

# FIPS servercore builds: ltsc2022 only (with/without JMX)
docker_build_fips_agent7_windows:
  extends: .docker_build_fips_agent7_windows_common
  parallel:
    matrix:
      - VARIANT: "ltsc2022"
        SERVER_BASE_IMAGE: "mcr.microsoft.com/dotnet/sdk:9.0-windowsservercore-ltsc2022"
        WINDOWS_RUNNER: "windows-v2:2022"
        OS_TYPE: "core"
        OS_DISPLAY_NAME: "windows server core"
        SERVERCORE: "-servercore"
        TAG_SUFFIX: ["-7-fips", "-7-fips-jmx"]
        WITH_JMX: ["false", "true"]
  tags: [$WINDOWS_RUNNER]
  variables:
    OVERRIDE_GIT_STRATEGY: "clone"
