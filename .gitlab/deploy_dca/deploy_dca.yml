---
# deploy dca stage
# Contains jobs which create child pipelines to deploy DCA to staging repositories and to Dockerhub / GCR.

deploy_dca:
  stage: deploy_dca
  rules:
    !reference [.on_deploy]
  variables:
    PARENT_PIPELINE_ID: $CI_PIPELINE_ID
    BUCKET_BRANCH: $BUCKET_BRANCH
  trigger:
    include: .gitlab/deploy_dca/deploy_dca_trigger.yml

deploy_dca-on-failure:
  stage: deploy_dca
  rules:
    !reference [.on_deploy_failure]
  variables:
    PARENT_PIPELINE_ID: $CI_PIPELINE_ID
    BUCKET_BRANCH: $BUCKET_BRANCH
    FORCE_MANUAL: "true"
  trigger:
    include: .gitlab/deploy_dca/deploy_dca_trigger.yml
