do-not-merge:
  stage: check_merge
  image: registry.ddbuild.io/ci/datadog-agent-buildimages/linux$CI_IMAGE_LINUX_SUFFIX:$CI_IMAGE_LINUX
  tags: ["arch:amd64-cidc"]
  rules:
    - !reference [.on_dev_branches]
    - when: always
  needs: []
  script:
    - |
      if [ -n "$CI_IMAGE_BTF_GEN_SUFFIX" ] ||
         [ -n "$CI_IMAGE_DEB_X64_SUFFIX" ] ||
         [ -n "$CI_IMAGE_DEB_ARM64_SUFFIX" ] ||
         [ -n "$CI_IMAGE_DEB_ARMHF_SUFFIX" ] ||
         [ -n "$CI_IMAGE_DOCKER_X64_SUFFIX" ] ||
         [ -n "$CI_IMAGE_DOCKER_ARM64_SUFFIX" ] ||
         [ -n "$CI_IMAGE_LINUX_GITLAB_AGENT_DEPLOY_SUFFIX" ] ||
         [ -n "$CI_IMAGE_LINUX_SUFFIX" ] ||
         [ -n "$CI_IMAGE_LINUX_RPM_X64_SUFFIX" ] ||
         [ -n "$CI_IMAGE_LINUX_RPM_ARM64_SUFFIX" ] ||
         [ -n "$CI_IMAGE_LINUX_RPM_ARMHF_SUFFIX" ] ||
         [ -n "$CI_IMAGE_LINUX_WIN_LTSC2022_X64_SUFFIX" ]; then
        echo "Pull request uses non-empty BUILDIMAGES_SUFFIX variable"
        echo "This workflow fails so that the pull request cannot be merged"
        exit 1
      fi
    - dda inv -- -e release.check-omnibus-branches --no-worktree || exit 1
    - exit 0
