do-not-merge:
  stage: check_merge
  image: 486234852809.dkr.ecr.us-east-1.amazonaws.com/ci/datadog-agent-buildimages/deb_x64$CI_IMAGE_DEB_X64_SUFFIX:$CI_IMAGE_DEB_X64_VERSION
  tags: ["arch:amd64"]
  rules: # this should only run on dev branches
  - if: $CI_PIPELINE_SOURCE =~ /^schedule.*$/
    when: never
  - if: $CI_COMMIT_TAG
    when: never
  - !reference [.except_main_or_release_branch]
  - when: always
  needs: []
  script:
      - |
          if [ ! -z "$CI_IMAGE_BTF_GEN_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_DDA_TESTING_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_DEB_ARM64_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_DEB_X64_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_DOCKER_X64_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_DOCKER_ARM64_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_RPM_ARM64_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_RPM_ARMHF_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_RPM_X64_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_SUSE_X64_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_SYSPROBE_X64_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_SYSPROBE_ARM_SUFFIX" ] ||
             [ ! -z "$CI_IMAGE_WINDOWS_SUFFIX" ] ||
             [ ! -z "$TEST_INFRA_DEFINITIONS_BUILDIMAGES_SUFFIX" ]; then
            echo "Pull request uses non-empty *_SUFFIX variable"
            echo "This workflow fails so that the pull request cannot be merged"
            exit 1
          fi
      - inv -e release.check-omnibus-branches || exit 1
      - exit 0
