kernel_version_testing_system_probe_linux_x64_ec2:
  extends:
    - .kitchen_common
    - .kitchen_ec2_location_us_east_1
    - .kitchen_ec2
  stage: kernel_version_testing
  rules:
    !reference [.on_system_probe_changes_or_manual]
  needs: [ "tests_ebpf_x64", "generate_minimized_btfs_x64", "pull_test_dockers_x64" ]
  variables:
    ARCH: x86_64
    EC2_INSTANCE_TYPE: "z1d.metal"
  before_script:
    - !reference [.retrieve_test_dockers]
    - !reference [.retrieve_minimized_btfs]
    - pushd $DD_AGENT_TESTING_DIR
  script:
    - inv -e system-probe.test-microvms --security-groups="[$KITCHEN_EC2_SG_IDS]" --subnet=$KITCHEN_EC2_SUBNET --instance-type-x86=$EC2_INSTANCE_TYPE

