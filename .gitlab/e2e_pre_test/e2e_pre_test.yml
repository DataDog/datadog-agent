# e2e_pre_test.yml
# Contains jobs which runs e2e tests to validate the new-e2e framework.
e2e_pre_test:
  rules:
    - !reference [.on_e2e_or_fakeintake_changes_or_manual]
  stage: e2e_pre_test
  extends: .new_e2e_template
  needs:
    - job: publish_fakeintake
      optional: true
  script:
    - inv -e new-e2e-tests.run --targets ./test-infra-definition --junit-tar junit-${CI_JOB_ID}.tgz ${EXTRA_PARAMS}
  after_script:
    - $CI_PROJECT_DIR/tools/ci/junit_upload.sh
  variables:
    TEAM: "agent-devx-loops"
    # override to use latest stable agent
    E2E_PIPELINE_ID: ""
