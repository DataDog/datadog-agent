---
.if_not_deploy: &if_not_deploy
  if: $DEPLOY_AGENT != "true"

.tests_windows_base:
  stage: source_test
  needs: []
  tags: ["runner:windows-docker", "windowsversion:1809"]
  script:
    - docker run --rm -m 8192M -v "$(Get-Location):c:\mnt" -e AWS_NETWORKING=true -e SIGN_WINDOWS=true -e PY_RUNTIMES="$PYTHON_RUNTIMES" 486234852809.dkr.ecr.us-east-1.amazonaws.com/ci/datadog-agent-buildimages/windows_1809_${ARCH}:$Env:DATADOG_AGENT_WINBUILDIMAGES c:\mnt\tasks\winbuildscripts\unittests.bat

tests_windows-x64:
  extends: .tests_windows_base
  variables:
    PYTHON_RUNTIMES: 3
    ARCH: "x64"

tests_windows-x86:
  rules:
    - <<: *if_not_deploy
  extends: .tests_windows_base
  variables:
    PYTHON_RUNTIMES: 3
    ARCH: "x86"
