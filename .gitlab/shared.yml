---

.get_artifactory_token: &get_artifactory_token
  - ARTIFACTORY_TOKEN=$(aws ssm get-parameter --region us-east-1 --name $ARTIFACTORY_TOKEN_SSM_NAME --with-decryption --query "Parameter.Value" --out text)

.setup_ruby_mirror:
  - set +x
  - *get_artifactory_token
  - if [ "${USE_CACHING_PROXY_RUBY}" = "true"]; then export BUNDLE_MIRROR__RUBYGEMS__ORG=https://${ARTIFACTORY_USERNAME}:{ARTIFACTORY_TOKEN}@{ARTIFACTORY_URL}/${ARTIFACTORY_GEMS_PATH}; fi
  - set -x
