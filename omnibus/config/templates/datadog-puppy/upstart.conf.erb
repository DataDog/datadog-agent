description "Datadog Agent"

start on started networking
stop on runlevel [!2345]

respawn

setuid dd-agent
console none

pre-start script
  lines=$(sed -n '$=' <%= log_dir %>/agent.log)
  if test $lines -ge 100; then
   mv <%= log_dir %>/agent.log <%= log_dir %>/agent.log.1;
  end
end script

script
  exec <%= install_dir %>/bin/agent/agent start -p <%= install_dir %>/run/agent.pid 2>> <%= log_dir %>/agent.stderr.log
end script

post-stop script
 rm -f <%= install_dir %>/run/agent.pid
 rm -f /tmp/agent.sock
end script
