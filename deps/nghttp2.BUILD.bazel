load("@rules_cc//cc:defs.bzl", "cc_library")
load("@rules_license//rules:license.bzl", "license")

package(
    default_applicable_licenses = [":license"],
    default_visibility = ["//visibility:private"],
)

license(
    name = "license",
    license_kinds = ["@rules_license//licenses/spdx:MIT"],
    # LICENSE file contains a single line that refers to COPYING
    license_text = "COPYING",
    visibility = ["//visibility:public"],
)

exports_files([
    "COPYING",
])

# This builds only the nghttp2 C library, not the C++ application code.
# Following the omnibus build configuration which uses:
# --disable-app --disable-examples --disable-hpack-tools
cc_library(
    name = "nghttp2",
    srcs = glob(
        [
            "lib/*.c",
            "lib/*.h",
        ],
    ),
    hdrs = glob([
        "lib/includes/**/*.h",
    ]) + [
        "config.h",
    ],
    includes = [
        ".",  # For config.h
        "lib/includes",
    ],
    visibility = ["//visibility:public"],
    # The library is pure C, no need for C++ linking
    copts = [
        "-DHAVE_CONFIG_H",
    ],
    target_compatible_with = [
        "@platforms//os:linux",
    ],
)
