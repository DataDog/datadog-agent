load("@bazel_skylib//rules:diff_test.bzl", "diff_test")
load("//bazel/tools:generate_module_bazel.bzl", "generate_module_bazel")

VERSION = "1.10.5"

generate_module_bazel(
    name = "module_bazel",
    out = "libpcap.MODULE.bazel.new",
    module = "libpcap",
    sha256 = "84fa89ac6d303028c1c5b754abff77224f45eca0a94eb1a34ff0aa9ceece3925",
    strip_prefix = "libpcap-%s" % VERSION,
    tags = ["manual"],
    url = "https://www.tcpdump.org/release/libpcap-%s.tar.xz" % VERSION,
)

diff_test(
    name = "module_consistency_test",
    failure_message = "To update: cp bazel-bin/deps/libpcap/libpcap.MODULE.bazel.new libpcap.MODULE.bazel",
    file1 = ":libpcap.MODULE.bazel.new",
    file2 = "libpcap.MODULE.bazel",
)
