# Global build settings

load("@bazel_skylib//rules:common_settings.bzl", "bool_flag", "string_flag")

package(default_visibility = ["//visibility:public"])

filegroup(
    name = "python_version",
    srcs = [".python-version"],
)

config_setting(
    name = "macos_arm64",
    constraint_values = [
        "@platforms//os:macos",
        "@platforms//cpu:arm64",
    ],
)

config_setting(
    name = "macos_x86_64",
    constraint_values = [
        "@platforms//os:macos",
        "@platforms//cpu:x86_64",
    ],
)

config_setting(
    name = "linux_x86_64",
    constraint_values = [
        "@platforms//os:linux",
        "@platforms//cpu:x86_64",
    ],
)

config_setting(
    name = "linux_arm64",
    constraint_values = [
        "@platforms//os:linux",
        "@platforms//cpu:arm64",
    ],
)

config_setting(
    name = "windows_x86_64",
    constraint_values = [
        "@platforms//os:windows",
        "@platforms//cpu:x86_64",
    ],
)

# The location base dir to install packages in while building.
string_flag(
    name = "install_dir",
    build_setting_default = "/tmp/opt/datadog-agent",
    make_variable = "INSTALL_DIR",
)

# Whether the build is for FIPS mode. Default is false.
bool_flag(
    name = "fips_mode",
    build_setting_default = False,
)

# There is no difference how we build openssl on Linux for FIPS.
# There is, however, on Windows.
config_setting(
    name = "fips_mode_enabled",
    constraint_values = [
        "@platforms//os:windows",
    ],
    flag_values = {
        ":fips_mode": "true",
    },
)
