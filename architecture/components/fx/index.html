<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The home of Datadog Agent developer documentation"><meta name=author content=Datadog><link href=https://datadoghq.dev/datadog-agent/architecture/components/fx/ rel=canonical><link href=../overview/ rel=prev><link href=../../dogstatsd/internals/ rel=next><link rel=icon href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.17"><title>Overview of Fx - Datadog Agent</title><link rel=stylesheet href=../../../assets/stylesheets/main.bcfcd587.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/css/custom.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/firacode@6.2.0/distr/fira_code.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#overview-of-fx class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Datadog Agent" class="md-header__button md-logo" aria-label="Datadog Agent" data-md-component=logo> <img src=../../../assets/images/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Datadog Agent </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Overview of Fx </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/DataDog/datadog-agent title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> datadog/datadog-agent </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../guidelines/contributing/ class=md-tabs__link> Guidelines </a> </li> <li class=md-tabs__item> <a href=../../../how-to/components/migration/ class=md-tabs__link> How-to </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../overview/ class=md-tabs__link> Architecture </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Datadog Agent" class="md-nav__button md-logo" aria-label="Datadog Agent" data-md-component=logo> <img src=../../../assets/images/logo.svg alt=logo> </a> Datadog Agent </label> <div class=md-nav__source> <a href=https://github.com/DataDog/datadog-agent title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> datadog/datadog-agent </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../../../setup/ class=md-nav__link> <span class=md-ellipsis> Setup </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Guidelines </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Guidelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../guidelines/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../../guidelines/docs/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../guidelines/components/purpose/ class=md-nav__link> <span class=md-ellipsis> Purpose </span> </a> </li> <li class=md-nav__item> <a href=../../../guidelines/components/defining-components/ class=md-nav__link> <span class=md-ellipsis> Defining Components </span> </a> </li> <li class=md-nav__item> <a href=../../../guidelines/components/using-components/ class=md-nav__link> <span class=md-ellipsis> Using Components </span> </a> </li> <li class=md-nav__item> <a href=../../../guidelines/components/defining-bundles/ class=md-nav__link> <span class=md-ellipsis> Defining Bundles </span> </a> </li> <li class=md-nav__item> <a href=../../../guidelines/components/defining-apps/ class=md-nav__link> <span class=md-ellipsis> Defining Apps </span> </a> </li> <li class=md-nav__item> <a href=../../../guidelines/components/registrations/ class=md-nav__link> <span class=md-ellipsis> Registrations </span> </a> </li> <li class=md-nav__item> <a href=../../../guidelines/components/subscriptions/ class=md-nav__link> <span class=md-ellipsis> Subscriptions </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> How-to </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> How-to </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../how-to/components/migration/ class=md-nav__link> <span class=md-ellipsis> Migration </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1 checked> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex> <span class=md-ellipsis> Components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=true> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Fx </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Fx </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-is-it class=md-nav__link> <span class=md-ellipsis> What Is It? </span> </a> </li> <li class=md-nav__item> <a href=#providing-and-requiring class=md-nav__link> <span class=md-ellipsis> Providing and Requiring </span> </a> </li> <li class=md-nav__item> <a href=#apps-and-options class=md-nav__link> <span class=md-ellipsis> Apps and Options </span> </a> </li> <li class=md-nav__item> <a href=#lifecycle class=md-nav__link> <span class=md-ellipsis> Lifecycle </span> </a> </li> <li class=md-nav__item> <a href=#ins-and-outs class=md-nav__link> <span class=md-ellipsis> Ins and Outs </span> </a> <nav class=md-nav aria-label="Ins and Outs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#value-groups class=md-nav__link> <span class=md-ellipsis> Value Groups </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex> <span class=md-ellipsis> DogStatsD </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> DogStatsD </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dogstatsd/internals/ class=md-nav__link> <span class=md-ellipsis> Internals </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-is-it class=md-nav__link> <span class=md-ellipsis> What Is It? </span> </a> </li> <li class=md-nav__item> <a href=#providing-and-requiring class=md-nav__link> <span class=md-ellipsis> Providing and Requiring </span> </a> </li> <li class=md-nav__item> <a href=#apps-and-options class=md-nav__link> <span class=md-ellipsis> Apps and Options </span> </a> </li> <li class=md-nav__item> <a href=#lifecycle class=md-nav__link> <span class=md-ellipsis> Lifecycle </span> </a> </li> <li class=md-nav__item> <a href=#ins-and-outs class=md-nav__link> <span class=md-ellipsis> Ins and Outs </span> </a> <nav class=md-nav aria-label="Ins and Outs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#value-groups class=md-nav__link> <span class=md-ellipsis> Value Groups </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/DataDog/datadog-agent/blob/main/docs/public/architecture/components/fx.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1 id=overview-of-fx>Overview of Fx<a class=headerlink href=#overview-of-fx title="Permanent link">&para;</a></h1> <p>The Agent uses <a href=https://uber-go.github.io/fx>Fx</a> as its application framework. While the linked Fx documentation is thorough, it can be a bit difficult to get started with. This document describes how Fx is used within the Agent in a more approachable style.</p> <h2 id=what-is-it>What Is It?<a class=headerlink href=#what-is-it title="Permanent link">&para;</a></h2> <p>Fx's core functionality is to create instances of required types "automatically," also known as <a href=https://en.wikipedia.org/wiki/Dependency_injection>dependency injection</a>. Within the agent, these instances are components, so Fx connects components to one another. Fx creates a single instance of each component, on demand.</p> <p>This means that each component declares a few things about itself to Fx, including the other components it depends on. An "app" then declares the components it contains to Fx, and instructs Fx to start up the whole assembly.</p> <h2 id=providing-and-requiring>Providing and Requiring<a class=headerlink href=#providing-and-requiring title="Permanent link">&para;</a></h2> <p>Fx connects components using types. Within the Agent, these are typically interfaces named <code>Component</code>. For example, <code>scrubber.Component</code> might be an interface defining functionality for scrubbing passwords from data structures:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:1><input checked=checked id=providing-and-requiring-scrubbercomponentgo name=__tabbed_1 type=radio><div class=tabbed-labels><label for=providing-and-requiring-scrubbercomponentgo><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06ZM3.28 7.78 1.81 9.25l1.47 1.47a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Zm8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/></svg></span> scrubber/component.go</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>type</span><span class=w> </span><span class=nx>Component</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>ScrubString</span><span class=p>(</span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>string</span>
<span class=p>}</span>
</code></pre></div> </div> </div> </div> <p>Fx needs to know how to <em>provide</em> an instance of this type when needed, and there are a few ways:</p> <ul> <li><a href=https://pkg.go.dev/go.uber.org/fx#Provide><code>fx.Provide(NewScrubber)</code></a> where <code>NewScrubber</code> is a constructor that returns a <code>scrubber.Component</code>. This indicates that if and when a <code>scrubber.Component</code> is required, Fx should call <code>NewScrubber</code>. It will call <code>NewScrubber</code> only once, using the same value everywhere it is required.</li> <li><a href=https://pkg.go.dev/go.uber.org/fx#Supply><code>fx.Supply(scrubber)</code></a> where <code>scrubber</code> implements the <code>scrubber.Component</code> interface. When another component requires a <code>scrubber.Component</code>, this is the instance it will get.</li> </ul> <p>The first form is much more common, as most components have constructors that do interesting things at runtime. A constructor can return multiple arguments, in which case the constructor is called if <em>any</em> of those argument types are required. Constructors can also return <code>error</code> as the final return type. Fx will treat an error as fatal to app startup.</p> <p>Fx also needs to know when an instance is <em>required</em>, and this is where the magic happens. In specific circumstances, it uses reflection to examine the argument list of functions, and creates instances of each argument's type. Those circumstances are:</p> <ul> <li>Constructors used with <code>fx.Provide</code>. Imagine <code>NewScrubber</code> depends on the config module to configure secret matchers: <div class=highlight><pre><span></span><code><span class=kd>func</span><span class=w> </span><span class=nx>NewScrubber</span><span class=p>(</span><span class=nx>config</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>Component</span><span class=p>)</span><span class=w> </span><span class=nx>Component</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>scrubber</span><span class=p>{</span>
<span class=w>        </span><span class=nx>matchers</span><span class=p>:</span><span class=w> </span><span class=nx>makeMatchersFromConfig</span><span class=p>(</span><span class=nx>config</span><span class=p>),</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></li> <li>Functions passed to <a href=https://pkg.go.dev/go.uber.org/fx#Invoke><code>fx.Invoke</code></a>: <div class=highlight><pre><span></span><code><span class=nx>fx</span><span class=p>.</span><span class=nx>Invoke</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>sc</span><span class=w> </span><span class=nx>scrubber</span><span class=p>.</span><span class=nx>Component</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;scrubbed: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>sc</span><span class=p>.</span><span class=nx>ScrubString</span><span class=p>(</span><span class=nx>somevalue</span><span class=p>))</span>
<span class=p>})</span>
</code></pre></div> Like constructors, Invoked functions can take multiple arguments, and can optionally return an error. Invoked functions are called automatically when an app is created.</li> <li> <p>Pointers passed to <a href=https://pkg.go.dev/go.uber.org/fx#Populate><code>fx.Populate</code></a>. <div class=highlight><pre><span></span><code><span class=kd>var</span><span class=w> </span><span class=nx>sc</span><span class=w> </span><span class=nx>scrubber</span><span class=p>.</span><span class=nx>Component</span>
<span class=c1>// ...</span>
<span class=nx>fx</span><span class=p>.</span><span class=nx>Populate</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>sc</span><span class=p>)</span>
</code></pre></div> Populate is useful in tests to fill an existing variable with a provided value. It's equivalent to <code>fx.Invoke(func(tmp scrubber.Component) { *sc = tmp })</code>.</p> <p>Functions can take multple arguments of different types, requiring all of them.</p> </li> </ul> <h2 id=apps-and-options>Apps and Options<a class=headerlink href=#apps-and-options title="Permanent link">&para;</a></h2> <p>You may have noticed that all of the <code>fx</code> methods defined so far return an <code>fx.Option</code>. They don't actually do anything on their own. Instead, Fx uses the <a href=https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html>functional options pattern</a> from Rob Pike. The idea is that a function takes a variable number of options, each of which has a different effect on the result.</p> <p>In Fx's case, the function taking the options is <a href=https://pkg.go.dev/go.uber.org/fx#New><code>fx.New</code></a>, which creates a new <a href=https://pkg.go.dev/go.uber.org/fx#New><code>fx.App</code></a>. It's within the context of an app that requirements are met, constructors are called, and so on.</p> <p>Tying the example above together, a very simple app might look like this:</p> <div class=highlight><pre><span></span><code><span class=nx>someValue</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;my password is hunter2&quot;</span>
<span class=nx>app</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>fx</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span>
<span class=w>    </span><span class=nx>fx</span><span class=p>.</span><span class=nx>Provide</span><span class=p>(</span><span class=nx>scrubber</span><span class=p>.</span><span class=nx>NewScrubber</span><span class=p>),</span>
<span class=w>    </span><span class=nx>fx</span><span class=p>.</span><span class=nx>Invoke</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>sc</span><span class=w> </span><span class=nx>scrubber</span><span class=p>.</span><span class=nx>Component</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;scrubbed: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>sc</span><span class=p>.</span><span class=nx>ScrubString</span><span class=p>(</span><span class=nx>somevalue</span><span class=p>))</span>
<span class=w>    </span><span class=p>}))</span>
<span class=nx>app</span><span class=p>.</span><span class=nx>Run</span><span class=p>()</span>
<span class=c1>// Output: scrubbed: my password is *******</span>
</code></pre></div> <p>For anything more complex, it's not practical to call <code>fx.Provide</code> for every component in a single source file. Fx has two abstraction mechanisms that allow combining lots of options into one app:</p> <ul> <li><a href=https://pkg.go.dev/go.uber.org/fx#Options><code>fx.Options</code></a> simply bundles several Option values into a single Option that can be placed in a variable. As the example in the Fx documentation shows, this is useful to gather the options related to a single Go package, which might include un-exported items, into a single value typically named <code>Module</code>.</li> <li><a href=https://pkg.go.dev/go.uber.org/fx#Module><code>fx.Module</code></a> is very similar, with two additional features. First, it requires a module name which is used in some Fx logging and can help with debugging. Second, it creates a scope for the effects of <a href=https://pkg.go.dev/go.uber.org/fx#Decorate><code>fx.Decorate</code></a> and <a href=https://pkg.go.dev/go.uber.org/fx#Replace><code>fx.Replace</code></a>. The second feature is not used in the Agent.</li> </ul> <p>So a slightly more complex version of the example might be:</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=apps-and-options-scrubbercomponentgo name=__tabbed_2 type=radio><input id=apps-and-options-maingo name=__tabbed_2 type=radio><div class=tabbed-labels><label for=apps-and-options-scrubbercomponentgo><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06ZM3.28 7.78 1.81 9.25l1.47 1.47a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Zm8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/></svg></span> scrubber/component.go</label><label for=apps-and-options-maingo><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06ZM3.28 7.78 1.81 9.25l1.47 1.47a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Zm8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/></svg></span> main.go</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>func</span><span class=w> </span><span class=nx>Module</span><span class=p>()</span><span class=w> </span><span class=nx>fxutil</span><span class=p>.</span><span class=nx>Module</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>fx</span><span class=p>.</span><span class=nx>Module</span><span class=p>(</span><span class=s>&quot;scrubber&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>fx</span><span class=p>.</span><span class=nx>Provide</span><span class=p>(</span><span class=nx>newScrubber</span><span class=p>))</span><span class=w>    </span><span class=c1>// now newScrubber need not be exported</span>
<span class=p>}</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nx>someValue</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;my password is hunter2&quot;</span>
<span class=nx>app</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>fx</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span>
<span class=w>    </span><span class=nx>scrubber</span><span class=p>.</span><span class=nx>Module</span><span class=p>(),</span>
<span class=w>    </span><span class=nx>fx</span><span class=p>.</span><span class=nx>Invoke</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>sc</span><span class=w> </span><span class=nx>scrubber</span><span class=p>.</span><span class=nx>Component</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;scrubbed: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>sc</span><span class=p>.</span><span class=nx>ScrubString</span><span class=p>(</span><span class=nx>somevalue</span><span class=p>))</span>
<span class=w>    </span><span class=p>}))</span>
<span class=nx>app</span><span class=p>.</span><span class=nx>Run</span><span class=p>()</span>
<span class=c1>// Output: scrubbed: my password is *******</span>
</code></pre></div> </div> </div> </div> <h2 id=lifecycle>Lifecycle<a class=headerlink href=#lifecycle title="Permanent link">&para;</a></h2> <p>Fx provides an <a href=https://pkg.go.dev/go.uber.org/fx#Lifecycle><code>fx.Lifecycle</code></a> component that allows hooking into application start-up and shut-down. Use it in your component's constructor like this:</p> <div class=highlight><pre><span></span><code><span class=kd>func</span><span class=w> </span><span class=nx>newScrubber</span><span class=p>(</span><span class=nx>lc</span><span class=w> </span><span class=nx>fx</span><span class=p>.</span><span class=nx>Lifecycle</span><span class=p>)</span><span class=w> </span><span class=nx>Component</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sc</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>scrubber</span><span class=p>{..}</span>
<span class=w>    </span><span class=nx>lc</span><span class=p>.</span><span class=nx>Append</span><span class=p>(</span><span class=nx>fx</span><span class=p>.</span><span class=nx>Hook</span><span class=p>{</span><span class=nx>OnStart</span><span class=p>:</span><span class=w> </span><span class=nx>sc</span><span class=p>.</span><span class=nx>start</span><span class=p>,</span><span class=w> </span><span class=nx>OnStop</span><span class=p>:</span><span class=w> </span><span class=nx>sc</span><span class=p>.</span><span class=nx>stop</span><span class=p>})</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sc</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sc</span><span class=w> </span><span class=o>*</span><span class=nx>scrubber</span><span class=p>)</span><span class=w> </span><span class=nx>start</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>..</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sc</span><span class=w> </span><span class=o>*</span><span class=nx>scrubber</span><span class=p>)</span><span class=w> </span><span class=nx>stop</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>..</span><span class=w> </span><span class=p>}</span>
</code></pre></div> <p>This separates the application's lifecycle into a few distinct phases:</p> <ul> <li>Initialization - calling constructors to satisfy requirements, and calling invoked functions that require them.</li> <li>Startup - calling components' OnStart hooks (in the same order the components were initialized)</li> <li>Runtime - steady state</li> <li>Shutdown - calling components' OnStop hooks (reverse of the startup order)</li> </ul> <h2 id=ins-and-outs>Ins and Outs<a class=headerlink href=#ins-and-outs title="Permanent link">&para;</a></h2> <p>Fx provides some convenience types to help build constructors that require or provide lots of types: <a href=https://pkg.go.dev/go.uber.org/fx#In><code>fx.In</code></a> and <a href=https://pkg.go.dev/go.uber.org/fx#Out><code>fx.Out</code></a>. Both types are embedded in structs, which can then be used as argument and return types for constructors, respectively. By convention, these are named <code>dependencies</code> and <code>provides</code> in Agent code:</p> <div class=highlight><pre><span></span><code><span class=kd>type</span><span class=w> </span><span class=nx>dependencies</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>fx</span><span class=p>.</span><span class=nx>In</span>

<span class=w>    </span><span class=nx>Config</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>Component</span>
<span class=w>    </span><span class=nx>Log</span><span class=w> </span><span class=nx>log</span><span class=p>.</span><span class=nx>Component</span>
<span class=w>    </span><span class=nx>Status</span><span class=w> </span><span class=nx>status</span><span class=p>.</span><span class=nx>Component</span>
<span class=p>)</span>

<span class=kd>type</span><span class=w> </span><span class=nx>provides</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>fx</span><span class=p>.</span><span class=nx>Out</span>

<span class=w>    </span><span class=nx>Component</span>
<span class=w>    </span><span class=c1>// ... (we&#39;ll see why this is useful below)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>newScrubber</span><span class=p>(</span><span class=nx>deps</span><span class=w> </span><span class=nx>dependencies</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>provides</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// can return an fx.Out struct and other types, such as error</span>
<span class=w>    </span><span class=c1>// ..</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>provides</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>Component</span><span class=p>:</span><span class=w> </span><span class=nx>scrubber</span><span class=p>,</span>
<span class=w>        </span><span class=c1>// ..</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div> <p>In and Out provide a nice way to summarize and document requirements and provided types, and also allow annotations via Go struct tags. Note that annotations are also possible with <a href=https://pkg.go.dev/go.uber.org/fx#Annotate><code>fx.Annotate</code></a>, but it is much less readable and its use is discouraged.</p> <h3 id=value-groups>Value Groups<a class=headerlink href=#value-groups title="Permanent link">&para;</a></h3> <p><a href=https://pkg.go.dev/go.uber.org/fx#hdr-Value_Groups>Value groups</a> make it easier to produce and consume many values of the same type. A component can add any type into groups which can be consumed by other components.</p> <p>For example:</p> <p>Here, two components add a <code>server.Endpoint</code> type to the <code>server</code> group (note the <code>group</code> label in the <code>fx.Out</code> struct).</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=value-groups-todolisttodolistgo name=__tabbed_3 type=radio><input id=value-groups-usersusersgo name=__tabbed_3 type=radio><div class=tabbed-labels><label for=value-groups-todolisttodolistgo><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06ZM3.28 7.78 1.81 9.25l1.47 1.47a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Zm8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/></svg></span> todolist/todolist.go</label><label for=value-groups-usersusersgo><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06ZM3.28 7.78 1.81 9.25l1.47 1.47a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Zm8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/></svg></span> users/users.go</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>type</span><span class=w> </span><span class=nx>provides</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>fx</span><span class=p>.</span><span class=nx>Out</span>
<span class=w>    </span><span class=nx>Component</span>
<span class=w>    </span><span class=nx>Endpoint</span><span class=w> </span><span class=nx>server</span><span class=p>.</span><span class=nx>Endpoint</span><span class=w> </span><span class=s>`group:&quot;server&quot;`</span>
<span class=p>}</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>type</span><span class=w> </span><span class=nx>provides</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>fx</span><span class=p>.</span><span class=nx>Out</span>
<span class=w>    </span><span class=nx>Component</span>
<span class=w>    </span><span class=nx>Endpoint</span><span class=w> </span><span class=nx>server</span><span class=p>.</span><span class=nx>Endpoint</span><span class=w> </span><span class=s>`group:&quot;server&quot;`</span>
<span class=p>}</span>
</code></pre></div> </div> </div> </div> <p>Here, a component requests all the types added to the <code>server</code> group. This takes the form of a slice received at instantiation (note once again the <code>group</code> label but in <code>fx.In</code> struct).</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:1><input checked=checked id=value-groups-serverservergo name=__tabbed_4 type=radio><div class=tabbed-labels><label for=value-groups-serverservergo><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06ZM3.28 7.78 1.81 9.25l1.47 1.47a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Zm8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/></svg></span> server/server.go</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>type</span><span class=w> </span><span class=nx>dependencies</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>fx</span><span class=p>.</span><span class=nx>In</span>
<span class=w>    </span><span class=nx>Endpoints</span><span class=w> </span><span class=p>[]</span><span class=nx>Endpoint</span><span class=w> </span><span class=s>`group:&quot;server&quot;`</span>
<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h1 id=day-to-day-usage>Day-to-Day Usage<a class=headerlink href=#day-to-day-usage title="Permanent link">&para;</a></h1> <p>Day-to-day, the Agent's use of Fx is fairly formulaic. Following the <a href=../../../guidelines/components/purpose/ >component guidelines</a>, or just copying from other components, should be enough to make things work without a deep understanding of Fx's functionality.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">March 12, 2024</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../overview/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Overview </div> </div> </a> <a href=../../dogstatsd/internals/ class="md-footer__link md-footer__link--next" aria-label="Next: Internals"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Internals </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; Datadog, Inc. 2024-present </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.datadoghq.com/blog/engineering/ target=_blank rel=noopener title=www.datadoghq.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M192 32c0 17.7 14.3 32 32 32 123.7 0 224 100.3 224 224 0 17.7 14.3 32 32 32s32-14.3 32-32C512 128.9 383.1 0 224 0c-17.7 0-32 14.3-32 32zm0 96c0 17.7 14.3 32 32 32 70.7 0 128 57.3 128 128 0 17.7 14.3 32 32 32s32-14.3 32-32c0-106-86-192-192-192-17.7 0-32 14.3-32 32zm-96 16c0-26.5-21.5-48-48-48S0 117.5 0 144v224c0 79.5 64.5 144 144 144s144-64.5 144-144-64.5-144-144-144h-16v96h16c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48V144z"/></svg> </a> <a href=https://github.com/DataDog target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/datadoghq target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://www.instagram.com/datadoghq target=_blank rel=noopener title=www.instagram.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.code.copy", "navigation.expand", "navigation.footer", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.1e8ae164.min.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body> </html>