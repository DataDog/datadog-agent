<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The home of Datadog Agent developer documentation"><meta name=author content=Datadog><link href=https://datadoghq.dev/datadog-agent/guidelines/languages/RUST/ rel=canonical><link rel=icon href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.23"><title>Rust in the Datadog Agent - Datadog Agent</title><link rel=stylesheet href=../../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/css/custom.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/firacode@6.2.0/distr/fira_code.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#rust-in-the-datadog-agent class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Datadog Agent" class="md-header__button md-logo" aria-label="Datadog Agent" data-md-component=logo> <img src=../../../assets/images/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Datadog Agent </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Rust in the Datadog Agent </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/DataDog/datadog-agent title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </div> <div class=md-source__repository> datadog/datadog-agent </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../how-to/build/standalone/ class=md-tabs__link> How-to </a> </li> <li class=md-tabs__item> <a href=../../../tutorials/dev/env/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../contributing/ class=md-tabs__link> Guidelines </a> </li> <li class=md-tabs__item> <a href=../../../components/overview/ class=md-tabs__link> Components </a> </li> <li class=md-tabs__item> <a href=../../../architecture/dogstatsd/internals/ class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../../../reference/images/dev/ class=md-tabs__link> Reference </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Datadog Agent" class="md-nav__button md-logo" aria-label="Datadog Agent" data-md-component=logo> <img src=../../../assets/images/logo.svg alt=logo> </a> Datadog Agent </label> <div class=md-nav__source> <a href=https://github.com/DataDog/datadog-agent title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </div> <div class=md-source__repository> datadog/datadog-agent </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=../../.. class="md-nav__link "> <span class=md-ellipsis> Home </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1_2> <label class=md-nav__link for=__nav_1_2 id=__nav_1_2_label tabindex=0> <span class=md-ellipsis> Setup </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../setup/required/ class=md-nav__link> <span class=md-ellipsis> Required </span> </a> </li> <li class=md-nav__item> <a href=../../../setup/optional/ class=md-nav__link> <span class=md-ellipsis> Optional </span> </a> </li> <li class=md-nav__item> <a href=../../../setup/manual/ class=md-nav__link> <span class=md-ellipsis> Manual </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> How-to </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> How-to </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> Build </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Build </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../how-to/build/standalone/ class=md-nav__link> <span class=md-ellipsis> Standalone agents </span> </a> </li> <li class=md-nav__item> <a href=../../../how-to/build/distributions/ class=md-nav__link> <span class=md-ellipsis> Distribution packages </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Test </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Test </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../how-to/test/unit/ class=md-nav__link> <span class=md-ellipsis> Unit tests </span> </a> </li> <li class=md-nav__item> <a href=../../../how-to/test/static-analysis/ class=md-nav__link> <span class=md-ellipsis> Static analysis </span> </a> </li> <li class=md-nav__item> <a href=../../../how-to/test/e2e/ class=md-nav__link> <span class=md-ellipsis> End-to-end tests </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../how-to/go/modules/ class=md-nav__link> <span class=md-ellipsis> Add nested modules </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_4> <div class="md-nav__link md-nav__container"> <a href=../../../how-to/debug-agents/ class="md-nav__link "> <span class=md-ellipsis> Debug agents </span> </a> <label class="md-nav__link " for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Debug agents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../how-to/debug-agents/linux/ class=md-nav__link> <span class=md-ellipsis> Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../how-to/debug-agents/windows/ class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> Memory profiling </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> Memory profiling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../how-to/memory-profiling/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../how-to/memory-profiling/go/ class=md-nav__link> <span class=md-ellipsis> Go </span> </a> </li> <li class=md-nav__item> <a href=../../../how-to/memory-profiling/python/ class=md-nav__link> <span class=md-ellipsis> Python </span> </a> </li> <li class=md-nav__item> <a href=../../../how-to/memory-profiling/c%2B%2B/ class=md-nav__link> <span class=md-ellipsis> C++ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Develop </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Develop </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/dev/env/ class=md-nav__link> <span class=md-ellipsis> Environment usage </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_1_2> <div class="md-nav__link md-nav__container"> <a href=../../../tutorials/dev/lab/ class="md-nav__link "> <span class=md-ellipsis> Lab environments </span> </a> <label class="md-nav__link " for=__nav_3_1_2 id=__nav_3_1_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> Lab environments </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/dev/lab/kind/ class=md-nav__link> <span class=md-ellipsis> Kind </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Guidelines </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Guidelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../docs/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Languages </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Languages </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../go/ class=md-nav__link> <span class=md-ellipsis> Go </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> Testing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Testing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../testing/test-categories/ class=md-nav__link> <span class=md-ellipsis> Test categories </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> Conventions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Conventions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../conventions/logging/ class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../components/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> Components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../components/creating-components/ class=md-nav__link> <span class=md-ellipsis> Creating components </span> </a> </li> <li class=md-nav__item> <a href=../../../components/testing/ class=md-nav__link> <span class=md-ellipsis> Testing components </span> </a> </li> <li class=md-nav__item> <a href=../../../components/using-components/ class=md-nav__link> <span class=md-ellipsis> Using components </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> Shared features from components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> Shared features from components </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_3_1> <label class=md-nav__link for=__nav_5_3_1 id=__nav_5_3_1_label tabindex=0> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_5_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3_1> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../components/shared_features/flares/ class=md-nav__link> <span class=md-ellipsis> Flare </span> </a> </li> <li class=md-nav__item> <a href=../../../components/shared_features/status/ class=md-nav__link> <span class=md-ellipsis> Status </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> DogStatsD </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> DogStatsD </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../architecture/dogstatsd/internals/ class=md-nav__link> <span class=md-ellipsis> Internals </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> Images </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Images </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/images/dev/ class=md-nav__link> <span class=md-ellipsis> Developer environment </span> </a> </li> <li class=md-nav__item> <a href=../../../reference/images/builders/ class=md-nav__link> <span class=md-ellipsis> Builders </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> Agent buildables </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Agent buildables </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/builds/components/ class=md-nav__link> <span class=md-ellipsis> Agent components </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#toolchain-configuration class=md-nav__link> <span class=md-ellipsis> Toolchain Configuration </span> </a> <nav class=md-nav aria-label="Toolchain Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bazel-module-configuration class=md-nav__link> <span class=md-ellipsis> Bazel Module Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#crate-management class=md-nav__link> <span class=md-ellipsis> Crate Management </span> </a> <nav class=md-nav aria-label="Crate Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-it-works class=md-nav__link> <span class=md-ellipsis> How It Works </span> </a> </li> <li class=md-nav__item> <a href=#bazel-integration class=md-nav__link> <span class=md-ellipsis> Bazel Integration </span> </a> </li> <li class=md-nav__item> <a href=#adding-dependencies-to-an-existing-component class=md-nav__link> <span class=md-ellipsis> Adding Dependencies to an Existing Component </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#adding-a-new-rust-component class=md-nav__link> <span class=md-ellipsis> Adding a New Rust Component </span> </a> <nav class=md-nav aria-label="Adding a New Rust Component"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-create-the-directory-structure class=md-nav__link> <span class=md-ellipsis> Step 1: Create the Directory Structure </span> </a> </li> <li class=md-nav__item> <a href=#step-2-add-your-component-to-the-cargo-workspace class=md-nav__link> <span class=md-ellipsis> Step 2: Add Your Component to the Cargo Workspace </span> </a> </li> <li class=md-nav__item> <a href=#step-3-create-your-components-cargotoml class=md-nav__link> <span class=md-ellipsis> Step 3: Create Your Component's Cargo.toml </span> </a> </li> <li class=md-nav__item> <a href=#step-4-regenerate-the-lock-file class=md-nav__link> <span class=md-ellipsis> Step 4: Regenerate the Lock File </span> </a> </li> <li class=md-nav__item> <a href=#step-5-create-buildbazel class=md-nav__link> <span class=md-ellipsis> Step 5: Create BUILD.bazel </span> </a> </li> <li class=md-nav__item> <a href=#step-6-build-and-test class=md-nav__link> <span class=md-ellipsis> Step 6: Build and Test </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#build-target-types class=md-nav__link> <span class=md-ellipsis> Build Target Types </span> </a> <nav class=md-nav aria-label="Build Target Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rust_library class=md-nav__link> <span class=md-ellipsis> rust_library </span> </a> </li> <li class=md-nav__item> <a href=#rust_shared_library class=md-nav__link> <span class=md-ellipsis> rust_shared_library </span> </a> </li> <li class=md-nav__item> <a href=#rust_binary class=md-nav__link> <span class=md-ellipsis> rust_binary </span> </a> </li> <li class=md-nav__item> <a href=#rust_test class=md-nav__link> <span class=md-ellipsis> rust_test </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#platform-restrictions class=md-nav__link> <span class=md-ellipsis> Platform Restrictions </span> </a> </li> <li class=md-nav__item> <a href=#release-builds class=md-nav__link> <span class=md-ellipsis> Release Builds </span> </a> </li> <li class=md-nav__item> <a href=#ci-integration class=md-nav__link> <span class=md-ellipsis> CI Integration </span> </a> </li> <li class=md-nav__item> <a href=#local-development-tips class=md-nav__link> <span class=md-ellipsis> Local Development Tips </span> </a> <nav class=md-nav aria-label="Local Development Tips"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-bazel-commands class=md-nav__link> <span class=md-ellipsis> Common Bazel Commands </span> </a> </li> <li class=md-nav__item> <a href=#updating-dependencies class=md-nav__link> <span class=md-ellipsis> Updating Dependencies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#further-reading class=md-nav__link> <span class=md-ellipsis> Further Reading </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/DataDog/datadog-agent/blob/main/docs/public/guidelines/languages/RUST.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <h1 id=rust-in-the-datadog-agent>Rust in the Datadog Agent<a class=headerlink href=#rust-in-the-datadog-agent title="Permanent link">&para;</a></h1> <p>This document describes how Rust components are built and integrated in the Datadog Agent repository.</p> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>The Datadog Agent uses <a href=https://github.com/bazelbuild/rules_rust>rules_rust</a> for building Rust code with Bazel and <a href=https://github.com/dzbarsky/rules_rs>rules_rs</a> to manage Cargo crates. This enables seamless integration with the existing Go and Python codebase, consistent toolchain management, and reproducible builds across the repository.</p> <blockquote> <p><strong>Important:</strong> We strongly encourage using Bazel directly for all Rust operations (building, testing, except Cargo.toml management) rather than Cargo. While Cargo may work for some local development tasks, Bazel is the source of truth for builds and ensures consistency with CI. All instructions in this document use Bazel commands.</p> </blockquote> <h2 id=toolchain-configuration>Toolchain Configuration<a class=headerlink href=#toolchain-configuration title="Permanent link">&para;</a></h2> <h3 id=bazel-module-configuration>Bazel Module Configuration<a class=headerlink href=#bazel-module-configuration title="Permanent link">&para;</a></h3> <p>The Rust toolchain is configured in <a href=/MODULE.bazel>MODULE.bazel</a>:</p> <div class="language-starlark highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>bazel_dep</span><span class=p>(</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;rules_rust&quot;</span><span class=p>,</span> <span class=n>version</span> <span class=o>=</span> <span class=s2>&quot;0.68.1&quot;</span><span class=p>)</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=n>rust</span> <span class=o>=</span> <span class=n>use_extension</span><span class=p>(</span><span class=s2>&quot;@rules_rust//rust:extensions.bzl&quot;</span><span class=p>,</span> <span class=s2>&quot;rust&quot;</span><span class=p>)</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=n>rust</span><span class=o>.</span><span class=n>toolchain</span><span class=p>(</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    <span class=n>edition</span> <span class=o>=</span> <span class=s2>&quot;2024&quot;</span><span class=p>,</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    <span class=n>versions</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;1.92.0&quot;</span><span class=p>],</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=p>)</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=n>use_repo</span><span class=p>(</span><span class=n>rust</span><span class=p>,</span> <span class=s2>&quot;rust_toolchains&quot;</span><span class=p>)</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=n>register_toolchains</span><span class=p>(</span><span class=s2>&quot;@rust_toolchains//:all&quot;</span><span class=p>)</span>
</span></code></pre></div> <p>This configuration: - Uses <strong>Rust 2024 edition</strong> as the default - Pins to <strong>Rust 1.92.0</strong> for reproducible builds - Registers toolchains for all supported platforms</p> <blockquote> <p><strong>Important:</strong> This is a global toolchain configuration that is used across the entire codebase of <code>datadog-agent</code>. The configuration in <a href=/MODULE.bazel>MODULE.bazel</a> <strong>should not be changed</strong> without proper testing to ensure that all <code>rust</code> components are still working.</p> </blockquote> <h2 id=crate-management>Crate Management<a class=headerlink href=#crate-management title="Permanent link">&para;</a></h2> <p>All external Rust crates are managed <strong>centrally</strong> through a single <a href=https://doc.rust-lang.org/cargo/reference/workspaces.html>Cargo workspace</a> defined in the root <a href=/Cargo.toml>Cargo.toml</a>. Individual components <strong>must not</strong> declare their own dependency versions — all versions live in the root <code>[workspace.dependencies]</code> section, and component <code>Cargo.toml</code> files reference them with <code>.workspace = true</code>.</p> <blockquote> <p><strong>Important:</strong> Do not add crate versions directly in a component's <code>Cargo.toml</code>. Every external dependency must be declared in the root <a href=/Cargo.toml>Cargo.toml</a> under <code>[workspace.dependencies]</code>. This ensures consistent versions across all Rust components, a single <code>Cargo.lock</code>, and a single source of truth for Bazel crate resolution.</p> </blockquote> <h3 id=how-it-works>How It Works<a class=headerlink href=#how-it-works title="Permanent link">&para;</a></h3> <p>The root <a href=/Cargo.toml>Cargo.toml</a> defines three things:</p> <ol> <li><strong><code>[workspace]</code></strong> — lists all Rust component directories as <code>members</code></li> <li><strong><code>[workspace.dependencies]</code></strong> — the single place where all external crate versions are pinned</li> <li><strong><code>[workspace.package]</code></strong> — shared metadata (<code>edition</code>, <code>license</code>, <code>rust-version</code>) inherited by all members</li> </ol> <p>A component's <code>Cargo.toml</code> then references workspace dependencies rather than specifying versions:</p> <div class="language-toml highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># Component Cargo.toml — NO version numbers here</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>[package]</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my_component&quot;</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=n>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;0.1.0&quot;</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=n>edition</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>license</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=n>rust-version</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=k>[dependencies]</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=n>anyhow</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=n>serde</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=c1># When a component needs specific features, add them on top of the workspace version:</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=n>tokio</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>workspace</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=n>features</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;macros&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;rt-multi-thread&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;signal&quot;</span><span class=p>]</span><span class=w> </span><span class=p>}</span>
</span></code></pre></div> <p>This produces a single <code>Cargo.lock</code> at the repository root — all components share the same resolved dependency graph.</p> <h3 id=bazel-integration>Bazel Integration<a class=headerlink href=#bazel-integration title="Permanent link">&para;</a></h3> <p>The workspace is registered once in <a href=/deps/crates.MODULE.bazel>deps/crates.MODULE.bazel</a>, pointing to the root <code>Cargo.toml</code> and <code>Cargo.lock</code>:</p> <div class="language-starlark highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>crate</span> <span class=o>=</span> <span class=n>use_extension</span><span class=p>(</span><span class=s2>&quot;@rules_rs//rs:extensions.bzl&quot;</span><span class=p>,</span> <span class=s2>&quot;crate&quot;</span><span class=p>)</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>crate</span><span class=o>.</span><span class=n>from_cargo</span><span class=p>(</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;crates&quot;</span><span class=p>,</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    <span class=n>cargo_lock</span> <span class=o>=</span> <span class=s2>&quot;//:Cargo.lock&quot;</span><span class=p>,</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>    <span class=n>cargo_toml</span> <span class=o>=</span> <span class=s2>&quot;//:Cargo.toml&quot;</span><span class=p>,</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>    <span class=n>platform_triples</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>        <span class=s2>&quot;aarch64-unknown-linux-gnu&quot;</span><span class=p>,</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>        <span class=s2>&quot;x86_64-unknown-linux-gnu&quot;</span><span class=p>,</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>    <span class=p>],</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>    <span class=n>validate_lockfile</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=p>)</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=n>use_repo</span><span class=p>(</span><span class=n>crate</span><span class=p>,</span> <span class=s2>&quot;crates&quot;</span><span class=p>)</span>
</span></code></pre></div> <p>All components reference crates from this single repository: <code>@crates//:&lt;crate_name&gt;</code>. There is intentionally only one <code>crate.from_cargo</code> entry — do not add per-component entries.</p> <h3 id=adding-dependencies-to-an-existing-component>Adding Dependencies to an Existing Component<a class=headerlink href=#adding-dependencies-to-an-existing-component title="Permanent link">&para;</a></h3> <ol> <li> <p><strong>Add the dependency version to the root <a href=/Cargo.toml>Cargo.toml</a></strong> under <code>[workspace.dependencies]</code> (skip if the crate is already listed): <div class="language-toml highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>[workspace.dependencies]</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>serde</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>version</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s2>&quot;1.0&quot;</span><span class=p>,</span><span class=w> </span><span class=n>features</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;derive&quot;</span><span class=p>]</span><span class=w> </span><span class=p>}</span>
</span></code></pre></div></p> </li> <li> <p><strong>Reference it in your component's <code>Cargo.toml</code></strong> using <code>.workspace = true</code> (never a version number): <div class="language-toml highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>[dependencies]</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>serde</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span></code></pre></div></p> </li> <li> <p><strong>Add the dependency to your <code>BUILD.bazel</code>:</strong> <div class="language-starlark highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>rust_library</span><span class=p>(</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;my_lib&quot;</span><span class=p>,</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=c1># ...</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>deps</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>        <span class=s2>&quot;@crates//:serde&quot;</span><span class=p>,</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    <span class=p>],</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=p>)</span>
</span></code></pre></div></p> </li> <li> <p><strong>Regenerate <code>Cargo.lock</code>:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>cargo<span class=w> </span>generate-lockfile
</span></code></pre></div></p> </li> <li> <p><strong>Commit both the root <code>Cargo.toml</code> and <code>Cargo.lock</code></strong></p> </li> </ol> <h2 id=adding-a-new-rust-component>Adding a New Rust Component<a class=headerlink href=#adding-a-new-rust-component title="Permanent link">&para;</a></h2> <p>Follow these steps to add a new Rust component to the repository.</p> <h3 id=step-1-create-the-directory-structure>Step 1: Create the Directory Structure<a class=headerlink href=#step-1-create-the-directory-structure title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>&lt;path_to_your_component&gt;
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>├── BUILD.bazel
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>├── Cargo.toml
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>├── src/
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>│   ├── lib.rs
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>│   └── main.rs  # if building a binary
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>└── tests/       # optional integration tests
</span></code></pre></div> <blockquote> <p><strong>Note:</strong> The component directory does <strong>not</strong> contain a <code>Cargo.lock</code> — the single lock file lives at the repository root.</p> </blockquote> <h3 id=step-2-add-your-component-to-the-cargo-workspace>Step 2: Add Your Component to the Cargo Workspace<a class=headerlink href=#step-2-add-your-component-to-the-cargo-workspace title="Permanent link">&para;</a></h3> <p>Edit the root <a href=/Cargo.toml>Cargo.toml</a>:</p> <ol> <li> <p><strong>Register your component as a workspace member:</strong> <div class="language-toml highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>[workspace]</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=n>members</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=s2>&quot;pkg/discovery/module/rust&quot;</span><span class=p>,</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=s2>&quot;pkg/procmgr/rust&quot;</span><span class=p>,</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span><span class=s2>&quot;pkg/your/component/rust&quot;</span><span class=p>,</span><span class=w>  </span><span class=c1># Add your component here</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=p>]</span>
</span></code></pre></div></p> </li> <li> <p><strong>Add any new crate versions</strong> to <code>[workspace.dependencies]</code> (all external crate versions must be declared here): <div class="language-toml highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=k>[workspace.dependencies]</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=c1># ... existing deps ...</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=n>my_new_dep</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1.0&quot;</span>
</span></code></pre></div></p> </li> </ol> <h3 id=step-3-create-your-components-cargotoml>Step 3: Create Your Component's <code>Cargo.toml</code><a class=headerlink href=#step-3-create-your-components-cargotoml title="Permanent link">&para;</a></h3> <p>The component <code>Cargo.toml</code> must <strong>not</strong> contain any dependency version numbers. Use <code>.workspace = true</code> to inherit versions from the root:</p> <div class="language-toml highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=k>[package]</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my_component&quot;</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=n>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;0.1.0&quot;</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=n>edition</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=n>license</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=n>rust-version</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=k>[lib]</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my_component&quot;</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=n>crate-type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;rlib&quot;</span><span class=p>]</span><span class=w>  </span><span class=c1># Add &quot;cdylib&quot; if you need FFI</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=k>[[bin]]</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my_binary&quot;</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;src/main.rs&quot;</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=k>[dependencies]</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=n>anyhow</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=n>serde</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=c1># When you need specific features on top of the workspace-declared version:</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=n>tokio</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>workspace</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=n>features</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;macros&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;rt-multi-thread&quot;</span><span class=p>]</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=k>[dev-dependencies]</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=n>tempfile</span><span class=p>.</span><span class=n>workspace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span></code></pre></div> <blockquote> <p><strong>Do not</strong> add <code>version = "..."</code> to dependencies in component <code>Cargo.toml</code> files. If the crate you need is not yet in the root <code>[workspace.dependencies]</code>, add it there first.</p> </blockquote> <h3 id=step-4-regenerate-the-lock-file>Step 4: Regenerate the Lock File<a class=headerlink href=#step-4-regenerate-the-lock-file title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>cargo<span class=w> </span>generate-lockfile
</span></code></pre></div> <blockquote> <p><strong>Note:</strong> You must run <code>cargo generate-lockfile</code> (or <code>cargo build</code>) whenever you change any <code>Cargo.toml</code>. If <code>Cargo.lock</code> is out of sync, Bazel will report an error: <div class="language-text highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>ERROR: Cargo.lock out of sync: sd-agent requires clap ^4.5.58 but Cargo.lock has 4.5.51.
</span></code></pre></div></p> </blockquote> <h3 id=step-5-create-buildbazel>Step 5: Create BUILD.bazel<a class=headerlink href=#step-5-create-buildbazel title="Permanent link">&para;</a></h3> <p>All components share the single <code>@crates</code> repository for external dependencies:</p> <div class="language-starlark highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>load</span><span class=p>(</span><span class=s2>&quot;@rules_rust//rust:defs.bzl&quot;</span><span class=p>,</span> <span class=s2>&quot;rust_binary&quot;</span><span class=p>,</span> <span class=s2>&quot;rust_library&quot;</span><span class=p>,</span> <span class=s2>&quot;rust_test&quot;</span><span class=p>)</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=n>rust_library</span><span class=p>(</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;my_component&quot;</span><span class=p>,</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>    <span class=n>srcs</span> <span class=o>=</span> <span class=n>glob</span><span class=p>([</span><span class=s2>&quot;src/**/*.rs&quot;</span><span class=p>],</span> <span class=n>exclude</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;src/main.rs&quot;</span><span class=p>]),</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>    <span class=n>crate_name</span> <span class=o>=</span> <span class=s2>&quot;my_component&quot;</span><span class=p>,</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>    <span class=n>edition</span> <span class=o>=</span> <span class=s2>&quot;2024&quot;</span><span class=p>,</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>    <span class=n>visibility</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;//visibility:public&quot;</span><span class=p>],</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>    <span class=n>deps</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>        <span class=s2>&quot;@crates//:anyhow&quot;</span><span class=p>,</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>        <span class=s2>&quot;@crates//:serde&quot;</span><span class=p>,</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>    <span class=p>],</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=p>)</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=n>rust_binary</span><span class=p>(</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;my_binary&quot;</span><span class=p>,</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>    <span class=n>srcs</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;src/main.rs&quot;</span><span class=p>],</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>    <span class=n>edition</span> <span class=o>=</span> <span class=s2>&quot;2024&quot;</span><span class=p>,</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>    <span class=n>visibility</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;//visibility:public&quot;</span><span class=p>],</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>    <span class=n>deps</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a>        <span class=s2>&quot;:my_component&quot;</span><span class=p>,</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>        <span class=s2>&quot;@crates//:anyhow&quot;</span><span class=p>,</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a>    <span class=p>],</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=p>)</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=n>rust_test</span><span class=p>(</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;my_component_test&quot;</span><span class=p>,</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a>    <span class=n>crate</span> <span class=o>=</span> <span class=s2>&quot;:my_component&quot;</span><span class=p>,</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a>    <span class=n>edition</span> <span class=o>=</span> <span class=s2>&quot;2024&quot;</span><span class=p>,</span>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a>    <span class=n>deps</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a>        <span class=s2>&quot;@crates//:tempfile&quot;</span><span class=p>,</span>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a>    <span class=p>],</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a><span class=p>)</span>
</span></code></pre></div> <h3 id=step-6-build-and-test>Step 6: Build and Test<a class=headerlink href=#step-6-build-and-test title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Build</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>bazel<span class=w> </span>build<span class=w> </span>//pkg/your/component/rust:my_component
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>bazel<span class=w> </span>build<span class=w> </span>//pkg/your/component/rust:my_binary
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=c1># Test</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>bazel<span class=w> </span><span class=nb>test</span><span class=w> </span>//pkg/your/component/rust:my_component_test
</span></code></pre></div> <h2 id=build-target-types>Build Target Types<a class=headerlink href=#build-target-types title="Permanent link">&para;</a></h2> <h3 id=rust_library>rust_library<a class=headerlink href=#rust_library title="Permanent link">&para;</a></h3> <p>For Rust libraries (produces <code>.rlib</code>):</p> <div class="language-starlark highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>rust_library</span><span class=p>(</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;my_lib&quot;</span><span class=p>,</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>    <span class=n>srcs</span> <span class=o>=</span> <span class=n>glob</span><span class=p>([</span><span class=s2>&quot;src/**/*.rs&quot;</span><span class=p>]),</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    <span class=n>crate_name</span> <span class=o>=</span> <span class=s2>&quot;my_lib&quot;</span><span class=p>,</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>    <span class=n>edition</span> <span class=o>=</span> <span class=s2>&quot;2024&quot;</span><span class=p>,</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>    <span class=n>deps</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;@crates//:serde&quot;</span><span class=p>],</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=p>)</span>
</span></code></pre></div> <h3 id=rust_shared_library>rust_shared_library<a class=headerlink href=#rust_shared_library title="Permanent link">&para;</a></h3> <p>For C-compatible shared libraries (produces <code>.so</code>/<code>.dylib</code>), useful for FFI with Go via cgo:</p> <div class="language-starlark highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=n>rust_shared_library</span><span class=p>(</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;libmy_lib&quot;</span><span class=p>,</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=n>srcs</span> <span class=o>=</span> <span class=n>glob</span><span class=p>([</span><span class=s2>&quot;src/**/*.rs&quot;</span><span class=p>]),</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=n>crate_name</span> <span class=o>=</span> <span class=s2>&quot;my_lib&quot;</span><span class=p>,</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>    <span class=n>crate_root</span> <span class=o>=</span> <span class=s2>&quot;src/lib.rs&quot;</span><span class=p>,</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>    <span class=n>edition</span> <span class=o>=</span> <span class=s2>&quot;2024&quot;</span><span class=p>,</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>    <span class=n>deps</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;@crates//:serde&quot;</span><span class=p>],</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=p>)</span>
</span></code></pre></div> <h3 id=rust_binary>rust_binary<a class=headerlink href=#rust_binary title="Permanent link">&para;</a></h3> <p>For executable binaries:</p> <div class="language-starlark highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=n>rust_binary</span><span class=p>(</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;my_tool&quot;</span><span class=p>,</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>    <span class=n>srcs</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;src/main.rs&quot;</span><span class=p>],</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>    <span class=n>edition</span> <span class=o>=</span> <span class=s2>&quot;2024&quot;</span><span class=p>,</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>    <span class=n>deps</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;:my_lib&quot;</span><span class=p>],</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=p>)</span>
</span></code></pre></div> <h3 id=rust_test>rust_test<a class=headerlink href=#rust_test title="Permanent link">&para;</a></h3> <p>For unit and integration tests:</p> <div class="language-starlark highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Unit tests (embedded in library)</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=n>rust_test</span><span class=p>(</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;my_lib_test&quot;</span><span class=p>,</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>    <span class=n>crate</span> <span class=o>=</span> <span class=s2>&quot;:my_lib&quot;</span><span class=p>,</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>    <span class=n>edition</span> <span class=o>=</span> <span class=s2>&quot;2024&quot;</span><span class=p>,</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>    <span class=n>deps</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;@crates//:tempfile&quot;</span><span class=p>],</span>  <span class=c1># dev-dependencies</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=p>)</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=c1># Integration tests (standalone test files)</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=n>rust_test</span><span class=p>(</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;integration_test&quot;</span><span class=p>,</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>    <span class=n>srcs</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;tests/integration_test.rs&quot;</span><span class=p>],</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a>    <span class=n>edition</span> <span class=o>=</span> <span class=s2>&quot;2024&quot;</span><span class=p>,</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>    <span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;:my_tool&quot;</span><span class=p>],</span>  <span class=c1># Binary needed at runtime</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>    <span class=n>rustc_env</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a>        <span class=s2>&quot;CARGO_BIN_EXE_my_tool&quot;</span><span class=p>:</span> <span class=s2>&quot;$(rootpath :my_tool)&quot;</span><span class=p>,</span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a>    <span class=p>},</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a>    <span class=n>deps</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a>        <span class=s2>&quot;@crates//:tempfile&quot;</span><span class=p>,</span>
</span><span id=__span-18-20><a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a>    <span class=p>],</span>
</span><span id=__span-18-21><a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a><span class=p>)</span>
</span></code></pre></div> <h2 id=platform-restrictions>Platform Restrictions<a class=headerlink href=#platform-restrictions title="Permanent link">&para;</a></h2> <p>To restrict targets to specific platforms, use <code>target_compatible_with</code>:</p> <div class="language-starlark highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=n>rust_library</span><span class=p>(</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;linux_only_lib&quot;</span><span class=p>,</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>    <span class=c1># ...</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>    <span class=n>target_compatible_with</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>        <span class=s2>&quot;@platforms//os:linux&quot;</span><span class=p>,</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>    <span class=p>],</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=p>)</span>
</span></code></pre></div> <h2 id=release-builds>Release Builds<a class=headerlink href=#release-builds title="Permanent link">&para;</a></h2> <p>For optimized release builds with size optimization, use the <code>sd-agent-release</code> config:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>bazel<span class=w> </span>build<span class=w> </span>--config<span class=o>=</span>sd-agent-release<span class=w> </span>//pkg/your/component/rust:my_binary
</span></code></pre></div> <p>This enables: - Fat LTO (Link-Time Optimization) - Size optimization (<code>opt-level=z</code>) - Symbol stripping - Panic abort (no stack unwinding)</p> <p>For custom release profiles, add to <code>bazel/configs/</code> and import in <code>.bazelrc</code>.</p> <blockquote> <p><strong>Note:</strong> right now we only have a release configuration that is sd-agent specific. However, if we identify that future components want to utilize the same configuration it can be promoted to the global <code>datadog-agent-release</code> configuration. For now, please, introduce your own <code>my_component.bazelrc</code> in <a href=/bazel/configs/ >bazel/configs/</a> and add <code>import %workspace%/bazel/configs/my_component.bazelrc</code> to <a href=/.bazelrc>.bazelrc</a> under <code>Project configs</code> section.</p> </blockquote> <h2 id=ci-integration>CI Integration<a class=headerlink href=#ci-integration title="Permanent link">&para;</a></h2> <blockquote> <p><strong>TODO:</strong> Describe how to add rust build to CI.</p> </blockquote> <p>In CI (with <code>--config=ci</code>), Rust builds automatically run:</p> <ul> <li><strong>Clippy</strong> checks via <code>rust_clippy_aspect</code></li> <li><strong>Rustfmt</strong> checks via <code>rustfmt_aspect</code></li> </ul> <p>Configuration from <code>.bazelrc</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>build:ci --aspects=@rules_rust//rust:defs.bzl%rust_clippy_aspect
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>build:ci --output_groups=+clippy_checks
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>build:ci --aspects=@rules_rust//rust:defs.bzl%rustfmt_aspect
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>build:ci --output_groups=+rustfmt_checks
</span></code></pre></div></p> <blockquote> <p><strong>Note:</strong> you can also enable these checks for your local development (for instance, to format code automatically). To do so create <code>user.bazelrc</code> file in the root of the project and just add the same flags without configuration name. This enforces unconditional usage of the flags for arbitrary <code>build</code> invocation: <div class="language-starlark highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=n>build</span> <span class=o>--</span><span class=n>aspects</span><span class=o>=</span><span class=nd>@rules_rust</span><span class=o>//</span><span class=n>rust</span><span class=p>:</span><span class=n>defs</span><span class=o>.</span><span class=n>bzl</span><span class=o>%</span><span class=n>rust_clippy_aspect</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=n>build</span> <span class=o>--</span><span class=n>output_groups</span><span class=o>=+</span><span class=n>clippy_checks</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=n>build</span> <span class=o>--</span><span class=n>aspects</span><span class=o>=</span><span class=nd>@rules_rust</span><span class=o>//</span><span class=n>rust</span><span class=p>:</span><span class=n>defs</span><span class=o>.</span><span class=n>bzl</span><span class=o>%</span><span class=n>rustfmt_aspect</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=n>build</span> <span class=o>--</span><span class=n>output_groups</span><span class=o>=+</span><span class=n>rustfmt_checks</span>
</span></code></pre></div></p> </blockquote> <h2 id=local-development-tips>Local Development Tips<a class=headerlink href=#local-development-tips title="Permanent link">&para;</a></h2> <h3 id=common-bazel-commands>Common Bazel Commands<a class=headerlink href=#common-bazel-commands title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># Build a target</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>bazel<span class=w> </span>build<span class=w> </span>//pkg/your/component/rust:my_component
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=c1># Run tests</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>bazel<span class=w> </span><span class=nb>test</span><span class=w> </span>//pkg/your/component/rust:my_component_test
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=c1># Build with verbose output</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>bazel<span class=w> </span>build<span class=w> </span>--verbose_failures<span class=w> </span>//pkg/your/component/rust:...
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=c1># Query dependencies</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>bazel<span class=w> </span>query<span class=w> </span><span class=s2>&quot;deps(//pkg/your/component/rust:my_lib)&quot;</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=c1># Check crate resolution</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>bazel<span class=w> </span>query<span class=w> </span><span class=s2>&quot;@crates//...&quot;</span>
</span></code></pre></div> <h3 id=updating-dependencies>Updating Dependencies<a class=headerlink href=#updating-dependencies title="Permanent link">&para;</a></h3> <p>After modifying any <code>Cargo.toml</code>, regenerate the lock file from the repository root:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># Alternatively, you can use cargo build command to do the same</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>cargo<span class=w> </span>generate-lockfile
</span></code></pre></div> <p>Bazel will fail if <code>Cargo.toml</code> and <code>Cargo.lock</code> are out of sync: <div class="language-text highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>ERROR: Cargo.lock out of sync: sd-agent requires clap ^4.5.58 but Cargo.lock has 4.5.51.
</span></code></pre></div></p> <h2 id=further-reading>Further Reading<a class=headerlink href=#further-reading title="Permanent link">&para;</a></h2> <ul> <li><a href=https://bazelbuild.github.io/rules_rust/ >rules_rust documentation</a> - Rust toolchain and build rules</li> <li><a href=https://github.com/dzbarsky/rules_rs>rules_rs documentation</a> - Crate management</li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">February 26, 2026</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; Datadog, Inc. 2024-present </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.datadoghq.com/blog/engineering/ target=_blank rel=noopener title=www.datadoghq.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M224 24c0-13.3 10.7-24 24-24 145.8 0 264 118.2 264 264 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-119.3-96.7-216-216-216-13.3 0-24-10.7-24-24M80 96c26.5 0 48 21.5 48 48v224c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48c-8.8 0-16-7.2-16-16v-64c0-8.8 7.2-16 16-16 79.5 0 144 64.5 144 144s-64.5 144-144 144S32 447.5 32 368V144c0-26.5 21.5-48 48-48m168 0c92.8 0 168 75.2 168 168 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-66.3-53.7-120-120-120-13.3 0-24-10.7-24-24s10.7-24 24-24"/></svg> </a> <a href=https://github.com/DataDog target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://twitter.com/datadoghq target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> <a href=https://www.instagram.com/datadoghq target=_blank rel=noopener title=www.instagram.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M224.3 141a115 115 0 1 0-.6 230 115 115 0 1 0 .6-230m-.6 40.4a74.6 74.6 0 1 1 .6 149.2 74.6 74.6 0 1 1-.6-149.2m93.4-45.1a26.8 26.8 0 1 1 53.6 0 26.8 26.8 0 1 1-53.6 0m129.7 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8M399 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.code.copy", "content.tabs.link", "content.tooltips", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.f55a23d4.min.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>