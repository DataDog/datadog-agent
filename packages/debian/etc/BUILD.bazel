"""Rules to build /etc for Debian distributions."""

load("@rules_pkg//pkg:install.bzl", "pkg_install")
load("@rules_pkg//pkg:mappings.bzl", "pkg_files", "strip_prefix")
load("//bazel/rules:dd_agent_expand_template.bzl", "dd_agent_expand_template")

package(default_visibility = ["//packages:__subpackages__"])

dd_agent_expand_template(
    name = "gen_etc",
    out = "etc/init/datadog-agent.conf",
    template = "upstart_debian.conf.in",
)

# TODO: Have dd_agent_expand_template emit a pkg provider, so we
# don't need this intermediary any more.
pkg_files(
    name = "all_files",
    srcs = [
        ":gen_etc",
    ],
    strip_prefix = strip_prefix.from_pkg(),
)

pkg_install(
    name = "install",
    srcs = [
        ":all_files",
    ],
)
