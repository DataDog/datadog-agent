load("@rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "eval",
    srcs = [
        "cidr.go",
        "context.go",
        "context_regular.go",
        "dns_linux.go",
        "dns_others.go",
        "errors.go",
        "eval.go",
        "eval_operators.go",
        "evaluators.go",
        "event.go",
        "field.go",
        "glob.go",
        "macro.go",
        "model.go",
        "oo_case_insensitive.go",
        "oo_extension.go",
        "oo_glob_cmp.go",
        "operators.go",
        "opts.go",
        "pattern.go",
        "registers.go",
        "rule.go",
        "state.go",
        "strings.go",
        "strings_others.go",
        "utils.go",
        "variables.go",
    ],
    importpath = "github.com/DataDog/datadog-agent/pkg/security/secl/compiler/eval",
    visibility = ["//visibility:public"],
    deps = [
        "//pkg/security/secl/compiler/ast",
        "//pkg/security/secl/utils",
        "@com_github_alecthomas_participle//lexer",
        "@com_github_charlievieth_strcase//:strcase",
        "@com_github_jellydator_ttlcache_v3//:ttlcache",
    ],
)

go_test(
    name = "eval_test",
    srcs = [
        "eval_test.go",
        "glob_test.go",
        "model_test.go",
        "oo_case_insensitive_test.go",
        "oo_glob_cmp_test.go",
        "pattern_test.go",
        "strings_linux_test.go",
        "strings_test.go",
    ],
    embed = [":eval"],
    deps = [
        "//pkg/security/secl/compiler/ast",
        "@com_github_stretchr_testify//assert",
        "@org_golang_x_text//cases",
        "@org_golang_x_text//language",
    ],
)
