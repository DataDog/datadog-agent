import { Trino } from "trino-client"; import { execSync } from "child_process"; const client = Trino.create({server: "https://trino-gateway.us1.staging.dog", catalog: "eventplatform", schema: "system", user: "jim.wilson", extraHeaders: {"Authorization": `Bearer ${execSync("ddtool auth token --datacenter us1.staging.dog apm-trino", {encoding: "utf8"}).trim()}`, "X-Trino-Extra-Credential": `orgId=2, clientId=trino-cli, userUuid=976714e4-1b76-11ee-87d8-aa0300114d4e, ddAuthJWT=${execSync("ddauth obo -d us1.staging.dog | grep dd-auth-jwt | cut -d\\" \\" -f2", {encoding: "utf8"}).trim()}`, "X-Trino-Client-Tags": "org_id=2"}}); const iter = await client.query("SELECT COUNT(*) FROM TABLE(eventplatform.system.track(TRACK => \"ndmflow\", QUERY => \"*\", TIME_RANGE => \"1h\"))"); for await (const result of iter) { if (result.data) console.log("ndmflow records:", result.data[0][0]); }
