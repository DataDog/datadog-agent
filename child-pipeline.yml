# Child pipeline – TEST: can this job depend on parent_job from the parent pipeline?
# If GitLab allows cross-pipeline needs, this job will wait for parent_job.
# Otherwise you should see an error like "parent_job not found" or the need being ignored.

stages:
  - run

# This attempts to depend on parent_job_parallel: a job from the PARENT pipeline
# that runs in parallel with the trigger, and to download its artifact.
# If the cross-pipeline need works, the artifact will be present; otherwise download fails or file is missing.
child_job_depends_on_parent:
  stage: run
  tags: ["arch:amd64", "specific:true"]
  needs:
    - pipeline: $PARENT_PIPELINE_ID
      job: parent_job_parallel
      artifacts: true
  script:
    - echo "Child job running (after parent_job_parallel?)"
    - test -f artifact-from-parent.txt && cat artifact-from-parent.txt
    - echo "Artifact from parent was present – dependency and artifact download worked."
  resource_group: test-$CI_COMMIT_SHA

# Fallback job in child with no cross-pipeline need (for comparison)
child_job_standalone:
  stage: run
  tags: ["arch:amd64", "specific:true"]
  script:
    - echo "Child job with no parent need"
