---
name: Slack emoji PR updates
on:
  pull_request_review:
    types: [submitted]
  pull_request:
    types: [closed]

permissions: {}

jobs:
  run_slapr_datadog_agent:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@0ad4b8fadaa221de15dcec353f45205ec38ea70b # v4.1.4
        with:
          ref: ${{ github.head_ref }}
      - name: Checkout PR
        # run only if triggered manually, otherwise we are already on the right branch and we won't have `pr_number`
        if: ${{ github.event_name == 'workflow_dispatch' }}
        run: gh pr checkout ${{ github.event.inputs.pr_number }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - uses: DataDog/slapr@celian/codeowners
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
          # SLACK_CHANNEL_ID: "${{ secrets.? }}"
          SLAPR_MULTICHANNEL: "true"
          SLACK_API_TOKEN: "${{ secrets.SLACK_API_TOKEN }}"
          SLAPR_BOT_USER_ID: "${{ secrets.SLAPR_BOT_USER_ID }}"
          SLAPR_EMOJI_REVIEW_STARTED: "review_started"
          SLAPR_EMOJI_APPROVED: "pr-approved-"
          SLAPR_EMOJI_CHANGES_REQUESTED: "changes_requested"
          SLAPR_EMOJI_MERGED: "merged"
          SLAPR_EMOJI_CLOSED: "closed"
