---
name: Slack emoji PR updates
on:
  pull_request_review:
    types: [submitted]
  pull_request:
    types: [closed]

jobs:
  run_slapr_datadog_agent:
    runs-on: ubuntu-latest
    env:
      SLAPR_MULTICHANNEL_TEAM_MAPPING: "slapr_team_mapping.json"
      GITHUB_TOKEN: "${{ secrets.SLAPR_GITHUB_TOKEN }}"
    steps:
      # - name: Checkout repository
      #   uses: actions/checkout@0ad4b8fadaa221de15dcec353f45205ec38ea70b # v4.1.4
      #   with:
      #     ref: ${{ github.head_ref }}
      #     persist-credentials: false
      # - name: Install python
      #   uses: actions/setup-python@0b93645e9fea7318ecaed2b359559ac225c90a2b # v5.3.0
      #   with:
      #     python-version: 3.12
      #     cache: "pip"
      # - name: Install Python dependencies
      #   run: |
      #     python -m pip install --upgrade pip
      #     pip install -r requirements.txt -r tasks/requirements.txt --break-system-packages
      # - name: Fetch team mapping file
      #   run: inv -e github.fetch-team-mapping --output "$SLAPR_MULTICHANNEL_TEAM_MAPPING"
      - uses: DataDog/slapr@celian/codeowners
        env:
          SLAPR_MULTICHANNEL: "true"
          SLACK_API_TOKEN: "${{ secrets.SLACK_API_TOKEN }}"
          SLAPR_BOT_USER_ID: "${{ secrets.SLAPR_BOT_USER_ID }}"
          SLAPR_EMOJI_REVIEW_STARTED: "review_started"
          SLAPR_EMOJI_APPROVED: "pr-approved-"
          SLAPR_EMOJI_CHANGES_REQUESTED: "changes_requested"
          SLAPR_EMOJI_MERGED: "merged"
          SLAPR_EMOJI_CLOSED: "closed"
