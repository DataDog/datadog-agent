---
- name: Prepare Connection
  hosts: localhost
  connection: local
  gather_facts: true
  tasks:
    - include_tasks: ../common/prepare/keypair.yml
    - include_tasks: ../common/create/wait-for-boot-process-to-finish.yml

- name: Prepare Integrations and Dependencies
  hosts: agent-integrations
  gather_facts: false
  tasks:
    - name: Gather facts (we need the docker network interface ip)
      setup:

    - include_tasks: ../common/prepare/docker-compose-cleanup.yml
    - include_tasks: ../common/prepare/run-docker-compose.yml
    - include_tasks: ../common/prepare/wait-for-receiver.yml
    - include_tasks: ../common/prepare/wait-for-agent.yml

- name: Prepare Connection
  hosts: localhost
  connection: local
  gather_facts: true
  tasks:
    - include_tasks: ../common/prepare/encrypt-key.yml
