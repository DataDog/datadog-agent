---
- name: GitLab | Download Artifacts
  when: ci_project_id is defined and ci_project_id != "" and ci_job_token is defined and ci_job_token != ""
  get_url:
    url: "https://gitlab.com/api/v4/projects/{{ ci_project_id }}/jobs/artifacts/main/download?job=create_{{ molecule_scenario_name }}_molecule"
    headers: 'JOB-TOKEN: {{ ci_job_token }}'
    dest: "./artifacts.zip"

- name: Extract Artifacts
  when: ci_project_id is defined and ci_project_id != "" and ci_job_token is defined and ci_job_token != ""
  unarchive:
    src: "./artifacts.zip"
    dest: "."

- name: Restore backup SSH key
  copy:
    src: "./.molecule-temp/ssh_key"
    dest: "{{ keypair_path }}"
    mode: preserve

- name: Wait (SSH Key Restore)
  pause:
    seconds: 15
