---
# - name: (CI) Decrypt data
#   when: ci_project_dir is defined and ci_project_dir != ""
#   shell: |
#     echo "{{ ci_job_token }}" > password
#     ansible-vault decrypt --vault-id test@password "{{ci_project_dir}}/.molecule/{{ molecule_scenario_name }}/ssh_key"
#     rm password

# - name: (Local) Decrypt data
#   when: ci_project_dir is undefined or ci_project_dir == ""
#   shell: |
#     echo "{{ ci_job_token }}" > password
#     ansible-vault decrypt --vault-id test@password ".molecule/{{ molecule_scenario_name }}/ssh_key"
#     rm password

# - name: (CI) Restore artifact ssh key
#   when: ci_project_dir is defined and ci_project_dir != ""
#   copy:
#     src: "{{ci_project_dir}}/.molecule/{{ molecule_scenario_name }}/ssh_key"
#     dest: "{{ keypair_path }}"
#     mode: preserve

- name: (Local) Restore artifact ssh key
  when: ci_project_dir is undefined or ci_project_dir == ""
  copy:
    src: ".molecule/{{ molecule_scenario_name }}/ssh_key"
    dest: "{{ keypair_path }}"
    mode: 0600

- name: (CI) Restore artifact ssh key
  when: ci_project_dir is defined and ci_project_dir != ""
  copy:
    src: "{{ci_project_dir}}/.molecule/{{ molecule_scenario_name }}/ssh_key"
    dest: "{{ keypair_path }}"
    mode: 0600

- name: Wait (SSH Key Restore)
  pause:
    seconds: 3
