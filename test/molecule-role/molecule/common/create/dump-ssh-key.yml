---
- name: Create the molecule temp storage directory
  file:
    path: "{{ ci_project_dir }}/.molecule-temp/{{ molecule_scenario_name }}"
    state: directory
    mode: '0755'

- name: Dump the ssh private key in the temp storage
  copy:
    dest: "{{ ci_project_dir }}/.molecule-temp/{{ molecule_scenario_name }}/ssh_key"
    content: "{{ keypair.key.private_key }}"
    mode: preserve

- name: Encrypt data
  shell: |
    echo "{{ ci_job_token }}" > password
    ansible-vault encrypt --vault-id test@password "{{ ci_project_dir }}/.molecule-temp/{{ molecule_scenario_name }}/ssh_key"
    rm password
