---
- name: Wait for instances found
  when: server is defined and server != "" and server.results is defined and (server.results | length) > 0
  debug:
    msg: "{{ server.results }}"

- name: Wait for instance(s) deletion to complete
  async_status:
    jid: "{{ item.ansible_job_id }}"
  register: ec2_jobs
  until: ec2_jobs.finished
  retries: 300
  when: server is defined and server != "" and server.results is defined and (server.results | length) > 0
  with_items: "{{ server.results }}"
