kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraMounts:
  - hostPath: /proc
    containerPath: /host/proc
{{- if .NewContainerdRegistryConfig }}
  - hostPath: ./certs.d
    containerPath: /etc/containerd/certs.d
{{- end }}
{{- if .DualNodeSetup }}
- role: worker
  extraMounts:
  - hostPath: /proc
    containerPath: /host/proc
{{- if .NewContainerdRegistryConfig }}
  - hostPath: ./certs.d
    containerPath: /etc/containerd/certs.d
{{- end }}
{{- end }} {{- /* end of .DualNodeSetup */}}
containerdConfigPatches:
  - |-
{{- if .NewContainerdRegistryConfig }}
    [plugins."io.containerd.grpc.v1.cri".registry]
      config_path = "/etc/containerd/certs.d"
{{- else }}
    [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]
      endpoint = ["https://mirror.gcr.io", "https://registry-1.docker.io"]
{{- end }}
networking:
  apiServerAddress: "0.0.0.0"
  apiServerPort: 8443
{{- if .KubeProxyReplacement }}
  disableDefaultCNI: true
  kubeProxyMode: "none"
{{- end }}
