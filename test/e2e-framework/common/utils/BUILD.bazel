load("@rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "utils",
    srcs = [
        "docker.go",
        "file.go",
        "hash.go",
        "json.go",
        "kubernetes.go",
        "log.go",
        "pointer.go",
        "pulumi.go",
        "random.go",
        "ssh.go",
        "strings.go",
        "version.go",
        "yaml.go",
    ],
    importpath = "github.com/DataDog/datadog-agent/test/e2e-framework/common/utils",
    visibility = ["//visibility:public"],
    deps = [
        "//test/e2e-framework/common/config",
        "//test/e2e-framework/common/namer",
        "@com_github_pulumi_pulumi_kubernetes_sdk_v4//go/kubernetes/core/v1:core",
        "@com_github_pulumi_pulumi_kubernetes_sdk_v4//go/kubernetes/meta/v1:meta",
        "@com_github_pulumi_pulumi_random_sdk_v4//go/random",
        "@com_github_pulumi_pulumi_sdk_v3//go/pulumi",
        "@in_gopkg_yaml_v3//:yaml_v3",
        "@org_golang_x_exp//maps",
    ],
)

go_test(
    name = "utils_test",
    srcs = [
        "docker_test.go",
        "version_test.go",
        "yaml_test.go",
    ],
    embed = [":utils"],
    embedsrcs = [
        "fixtures/tags_a.yaml",
        "fixtures/tags_ab.yaml",
        "fixtures/tags_b.yaml",
    ],
    deps = [
        "@com_github_stretchr_testify//assert",
        "@com_github_stretchr_testify//require",
        "@in_gopkg_yaml_v3//:yaml_v3",
    ],
)
