suites:

# Installs the latest release candidate using the install script
- name: install-script
  run_list:
    <% if ENV['FIPS'] == 'true' %>
    - "recipe[dd-agent-enable-fips::enable]"
    - "recipe[dd-agent-enable-fips::ensure]"
    <% end %>
    - "recipe[dd-agent-disable-system-repos]"
    - "recipe[dd-agent-sles-workaround]"
    - "recipe[dd-agent-install-script]"
  attributes:
    apt:
      unattended_upgrades:
        enable: false
    dd-agent-install-script:
      agent_flavor: <%= ENV['AGENT_FLAVOR'] || "datadog-agent" %>
      api_key: <%= api_key %>
      install_script_url: "https://s3.amazonaws.com/dd-agent/scripts/install_script_agent7.sh"
      repo_branch_apt: <%= aptrepo_dist %>
      repo_component_apt: <%= agent_major_version %>
      repo_branch_yum: testing/pipeline-<%= ENV['DD_PIPELINE_ID'] %>/<%= agent_major_version %>
      install_candidate: true
    dd-agent-rspec:
      agent_flavor: <%= ENV['AGENT_FLAVOR'] || "datadog-agent" %>
      skip_windows_signing_test: &skip_windows_signing_test <%= ENV['SKIP_SIGNATURE_TEST'] || false %>
