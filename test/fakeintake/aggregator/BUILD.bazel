load("@rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "aggregator",
    srcs = [
        "agenthealthAggregator.go",
        "apmStatsAggregator.go",
        "checkRunAggregator.go",
        "common.go",
        "connectionsAggregator.go",
        "containerAggregator.go",
        "containerImageAggregator.go",
        "containerLifecycleAggregator.go",
        "eventAggregator.go",
        "hostAggregator.go",
        "logAggregator.go",
        "metadataAggregator.go",
        "metricAggregator.go",
        "metricAggregatorV1.go",
        "ncmAggregator.go",
        "ndmAggregator.go",
        "ndmflowAggregator.go",
        "netpathAggregator.go",
        "orchestratorAggregator.go",
        "orchestratorManifAggregator.go",
        "processAggregator.go",
        "processDiscoveryAggregator.go",
        "sbomAggregator.go",
        "traceAggregator.go",
    ],
    importpath = "github.com/DataDog/datadog-agent/test/fakeintake/aggregator",
    visibility = ["//visibility:public"],
    deps = [
        "//comp/netflow/payload",
        "//pkg/metrics/event",
        "//pkg/networkpath/payload",
        "//pkg/proto/pbgo/trace",
        "//test/fakeintake/api",
        "@com_github_datadog_agent_payload_v5//contimage",
        "@com_github_datadog_agent_payload_v5//contlcycle",
        "@com_github_datadog_agent_payload_v5//gogen",
        "@com_github_datadog_agent_payload_v5//healthplatform",
        "@com_github_datadog_agent_payload_v5//process",
        "@com_github_datadog_agent_payload_v5//sbom",
        "@com_github_datadog_zstd//:zstd",
        "@com_github_samber_lo//:lo",
        "@com_github_tinylib_msgp//msgp",
        "@org_golang_google_protobuf//proto",
    ],
)

go_test(
    name = "aggregator_test",
    srcs = [
        "agenthealthAggregator_test.go",
        "apmStatsAggregator_test.go",
        "checkRunAggregator_test.go",
        "common_test.go",
        "connectionsAggregator_test.go",
        "containerAggregator_test.go",
        "containerImageAggregator_test.go",
        "containerLifecycleAggregator_test.go",
        "eventAggregator_test.go",
        "logAggregator_test.go",
        "metadataAggregator_test.go",
        "metricAggregatorV1_test.go",
        "metricAggregator_test.go",
        "ndmAggregator_test.go",
        "ndmflowAggregator_test.go",
        "netpathAggregator_test.go",
        "orchestratorAggregator_test.go",
        "orchestratorManifAggregator_test.go",
        "processAggregator_test.go",
        "processDiscoveryAggregator_test.go",
        "sbomAggregator_test.go",
        "traceAggregator_test.go",
    ],
    embed = [":aggregator"],
    embedsrcs = [
        "fixtures/apm_stats_bytes",
        "fixtures/checkrun_bytes",
        "fixtures/connections_bytes",
        "fixtures/contimage_bytes",
        "fixtures/contlcycle_bytes",
        "fixtures/event_json_bytes",
        "fixtures/log_bytes",
        "fixtures/metadata_bytes",
        "fixtures/metric_bytes",
        "fixtures/metric_bytes_v1",
        "fixtures/metric_json_bytes",
        "fixtures/ndm_bytes",
        "fixtures/ndmflow_bytes",
        "fixtures/netpath_bytes",
        "fixtures/orch_bytes",
        "fixtures/orchmanif_bytes",
        "fixtures/sbom_bytes",
        "fixtures/trace_bytes",
        "fixtures/agenthealth_bytes",
        "fixtures/agenthealth_multi_bytes",
        "fixtures/agenthealth_noissues_bytes",
    ],
    deps = [
        "//pkg/metrics/event",
        "//pkg/networkpath/payload",
        "//test/fakeintake/api",
        "//test/fakeintake/fixtures",
        "@com_github_datadog_agent_payload_v5//process",
        "@com_github_kr_pretty//:pretty",
        "@com_github_stretchr_testify//assert",
        "@com_github_stretchr_testify//require",
    ],
)
